<h2>Access high-performance storage</h2><p>In 2020, WEHI purchased a <a href="https://vastdata.com/">VAST</a> all-flash high-performance storage system. Researchers with are encouraged to use this resource. Because of the high cost of flash storage, data should only be stored here when it is active (defined in more detail below).</p>
<h3><span class="fontColorThemeSecondary">In Summary</span></h3><p>Ideally as much of your reading/writing should be directed from/to VAST.</p><p>VAST scratch is best suited for intermediary or temporary files, not needed for much longer after they're created. This is because the 14-day deletion policy removes them automatically, without your intervention.</p><p>On the other hand, VAST projects, while also high-performant, does not have a 14-day deletion policy. Therefore, we recommend that files placed here are files that need to be analysed or returned to later than 14 days. However, important files e.g. final results, should be stored in the Stornext filesystem as that is backed up.</p>
<h4><span class="fontColorBlue">Contents on this page:</span></h4><p><a href="/sites/rc2/SitePages/high-performance-storage.aspx#access-high-performance-storage">Access high-performance storage</a><br><a href="/sites/rc2/SitePages/high-performance-storage.aspx#using-the-scratch-filesystem">Using the Scratch filesystem</a><br><a href="/sites/rc2/SitePages/high-performance-storage.aspx#application-process-for-the-scratch-filesystem">Application process for the Scratch filesystem</a><br><a href="/sites/rc2/SitePages/high-performance-storage.aspx#project-areas">Project areas</a><br><a href="/sites/rc2/SitePages/high-performance-storage.aspx#application-process-for-project-areas">Application process for project areas</a><br><a href="/sites/rc2/SitePages/high-performance-storage.aspx#extending-current-allocation">Extending current allocation</a><br><a href="/sites/rc2/SitePages/high-performance-storage.aspx#project-lifecycle">Project lifecycle</a><br><a href="/sites/rc2/SitePages/high-performance-storage.aspx#recommendations">Recommendations</a><br><a href="/sites/rc2/SitePages/high-performance-storage.aspx#copying-data">Copying data</a></p>
<p><span class="fontColorRed"><strong>Note:</strong></span>&nbsp; <span class="fontColorBlue">There are </span><span class="fontColorNeutralDark"><strong>no long-term backups</strong></span><span class="fontColorBlue"> of VAST storage. Primary data can be stored on it during analysis but another copy must be on managed storage, such as a lab area, that has offsite tape backups.</span></p>
<p>This page describes how to access and use the storage. The policy for governing use and access is called the <a href="/:w:/r/sites/rc2/Shared%20Documents/Policies%20and%20Operation%20Procedures/PSM_Policy%20v2.0.docx?d=we169151bf4214bf7a6984a9fbb4587df&amp;csf=1&amp;web=1&amp;e=ew1cwt" data-interception="off" target="_blank" rel="noopener noreferrer">Performant Storage Management Policy v2.0.</a></p><p>The preferred use of the new storage is a traditional high-performance Scratch area, however, it is also possible to request a longer-term 'project' allocation.</p><h3><span class="fontColorThemeSecondary">Using the Scratch filesystem</span></h3><p>Users can write large amounts of data to the scratch filesystem but it will be <span class="fontColorBlue"><strong><u>AUTOMATICALLY DELETED</u></strong></span> after a period of inactivity. This makes the most efficient use of the space. Typical use cases include iterative analysis on the same input data and multi-stage pipelines.</p><p style="margin-left:0px;"><span dir="ltr" lang="EN-AU">When granted HPC access, users will be allocated a directory in the scratch space for temporary data storage. Users requiring longer-term storage due to special circumstances can apply for a project allocation. </span>&nbsp;</p><p>Once access is granted, a personal area will be created using your user id:</p><pre><span class="fontColorBlue"><strong>/vast/scratch/users/&lt;userid&gt;</strong></span>\n</pre><p>which, by default, will only be accessible by the owner. You may then change these permissions to allow others access check <a href="/sites/rc2/SitePages/high-performance-storage.aspx#giving-other-researchers-access-to-your-vast-scratch-space" data-interception="off" target="_blank" rel="noopener noreferrer">this section</a> for more details.&nbsp;</p><p style="margin-left:0px;"><span dir="ltr" lang="EN-AU">Files stored in this directory will be automatically deleted </span><span class="fontColorBlue" dir="ltr" lang="EN-AU"><strong><u>14 days</u></strong><u> </u><strong><u>after last access </u></strong></span><i><span class="fontColorBlue" dir="ltr" lang="EN-AU"><strong><u>without exception and with no notification</u></strong></span></i><span dir="ltr" lang="EN-AU"><strong>.</strong> </span>&nbsp;</p><p style="margin-left:0px;"><span dir="ltr" lang="EN-AU">Users should acknowledge the risks associated with data volatility in scratch spaces. </span><span class="fontColorRedDark" dir="ltr" lang="EN-AU"><strong><u>Scratch is not backed up.</u></strong></span><span dir="ltr" lang="EN-AU"> As such, it is the responsibility of the individual users and research groups to ensure that any data requiring backup are manually moved to another managed storage. </span>&nbsp;</p><h4 style="margin-left:0px;"><span class="fontColorBlue" dir="ltr" lang="EN-AU">Quota Management:</span><span class="fontColorBlue">&nbsp;</span></h4><p style="margin-left:0px;"><span dir="ltr" lang="EN-AU">Each user is assigned space and inode (number of files) quotas, balancing generous capacity with safeguards against system abuse. The space quotas will be <strong>100TB</strong> and the inode quota of <strong>10 million</strong> . Quota sizes and policies periodically reviewed to align with user needs and system capabilities. </span>&nbsp;</p><h4 style="margin-left:0px;"><span class="fontColorBlue" dir="ltr" lang="EN-US">Compliance with Auto-Deletion Policy</span><span class="fontColorBlue" dir="ltr" lang="EN-AU">:</span><span class="fontColorBlue">&nbsp;</span></h4><p style="margin-left:0px;"><span dir="ltr" lang="EN-AU">Non-compliance entails the intentional regular execution of commands or scripts with the sole purpose of extending the residency of files in the user’s scratch directory beyond the auto-deletion period by modifying the file access timestamps. An example of non-compliant behaviour is regularly running the ‘touch’ command, either manually or by an automated script.</span>&nbsp;</p><p style="margin-left:0px;"><span class="fontColorRedDark" dir="ltr" lang="EN-AU"><strong><u>Users found to be intentionally manipulating the system to circumvent the auto-deletion policy will face immediate consequences</u></strong><u>.</u> A first violation will trigger a warning and a demand to cease such actions. A second offence will suspend the user's access to the scratch space for one month. Further violations may lead to permanent revocation of access.</span><span class="fontColorRedDark">&nbsp;</span></p><p style="margin-left:0px;"><span dir="ltr" lang="EN-AU">Users subject to these penalties may appeal the decision by submitting an explanation to the Research Computing Management Team. The appeal should include a detailed account of the actions leading to the violation and any mitigating circumstances. </span>&nbsp;</p><h4 style="margin-left:0px;"><span class="fontColorBlue" dir="ltr" lang="EN-AU">Managing contention:</span><span class="fontColorBlue">&nbsp;</span></h4><p style="margin-left:0px;"><span dir="ltr" lang="EN-AU">Users should be aware of the inherent risk of scratch space filling up, blocking data writes.  The RCP and ITS teams will actively monitor scratch space usage and implement policy adjustments to mitigate these risks. </span>&nbsp;</p><p style="margin-left:0px;"><span dir="ltr" lang="EN-AU">If scratch space utilization approaches <strong>70%</strong> capacity, the following measures will be considered to manage contention: </span>&nbsp;</p><ul><li><p style="margin-left:0px;"><span dir="ltr" lang="EN-AU">Encouraging users to clean up their scratch space.  </span>&nbsp;</p></li><li><p style="margin-left:0px;"><span dir="ltr" lang="EN-AU">In extreme cases, user quota will be decreased to preserve system integrity. </span>&nbsp;</p></li></ul><p>There is also a small chance that scratch may fill up causing jobs to fail until support is available during business hours. <span class="fontColorBlue">Please monitor how much space you are using and delete files that you know will not be needed again, rather than waiting for automatic deletion.</span></p><h4><span class="fontColorBlue">How Auto-Deletion works on VAST?</span></h4><p><strong>Daily at 1 am</strong>, a process is run which will find and delete the following:</p><ol><li>All <strong>files</strong> with a last access time (<span class="fontColorBlue">atime</span>) greater than 14 days.</li><li>All <strong>empty</strong> directories with creating time (<span class="fontColorBlue">ctime</span>) greater than 14 days.</li></ol><h4><span class="fontColorBlue">Giving other researchers access to your VAST Scratch space</span></h4><p>In many cases, you may wish to enable other researchers to access files in your VAST Scratch. We generally recommend that you only allow give access to sub-directories of your VAST Scratch,. Please see our <a href="/sites/rc2/SitePages/File-Permissions.aspx#guidance-for-labs">recommendations on how to do this on our Linux permissions page.</a> It can be tricky to setup permissions, so if you would like help, please send an email to <a href="mailto:support@wehi.edu.au">support@wehi.edu.au</a>, or <a href="mailto:research.computing@wehi.edu.au">research.computing@wehi.edu.au</a>.&nbsp;</p><h4><span class="fontColorBlue">How to redirect TMP to vast scratch?</span></h4><p>Some workloads require large <span class="highlightColorGrey fontColorRed">TMPDIR</span> areas, some R packages for example. To create a per job <span class="highlightColorGrey fontColorRed">TMPDIR</span> area modify your job scripts as follows:</p><pre>export TMPDIR=$(mktemp -d --tmpdir=/vast/scratch/users/$USER)\n[commands]\nrm -rf $TMPDIR\n</pre><p>You can see how much data you are using with this command:</p><pre>du -sh /vast/scratch/users/$USER</pre><h4><span class="fontColorBlue">Application process for the Scratch filesystem</span></h4><p>New Milton HPC users are granted VAST scratch automatically.</p>
<h3><span class="fontColorThemeSecondary">Project areas</span></h3><p>It is recognised that a scratch-type filesystem will be awkward for some types of work, for example, where pipelines need to be rerun during exploratory phases over several weeks. For these types of projects, users can request a longer-term allocation, for example, 5TB for 3 months.</p><h4><span class="fontColorBlue">Application process for&nbsp;project areas</span></h4><p>Users can gain access by completing the service request form <a href="https://support.wehi.edu.au/support/catalog/items/72"><strong>here</strong></a> and your application will be reviewed by a member of the RCP team.</p><h4><span class="fontColorBlue">Extending current allocation</span></h4><p>Via the same <a href="https://support.wehi.edu.au/support/catalog/items/72"><strong>form</strong></a> as requesting a new application. Ensure that you select "existing" project when choosing the project.</p>
<p><span class="fontColorBlue">A request for a single allocation or extension of 5TB for 3 months will most likely be approved quickly. Larger, or more, allocations may need more justification, please refer to the</span> <a href="/:w:/s/ResearchComputingSteeringGroup/EXlM_pA0YiBFqVZhfH7RAJIB4J-3xTx7H5w9rCVXJF3M-Q?e=RTWPfu">Performant Storage Management Policy</a> <span class="fontColorBlue">for more detail.</span></p><p><span class="fontColorBlue">Prior to access being granted, you will need to have a chat with the</span> <a href="mailto:rcp@wehi.edu.au">Research Computing Platform</a> <span class="fontColorBlue">to discuss your data management plan and to ensure you understand appropriate use of this storage and navigate the management policies (e.g., lack of backup).</span></p>
<p>Once approved, a directory will be created called</p><pre><span class="fontColorBlue"><strong>/vast/projects/project-&lt;id&gt;</strong></span>\n</pre><p>with the appropriate permissions and quota.</p><h4><span class="fontColorBlue">Project lifecycle</span></h4><p>The lifetime of the project starts from when the project directory is created (not from the time data is written). Two weeks before the end of the project, the owner will be alerted by email. If the quota owner is uncontactable, does not respond, or has left the Institute, the owner's lab head will be approached to make arrangements to move the data. If the lab has left WEHI the responsibility will devolve to the division head. If no one takes responsibility for the data it will be DELETED.</p><h4><span class="fontColorBlue">Managing contention&nbsp;</span></h4><p style="margin-left:0px;"><span dir="ltr" lang="EN-AU">Proactive storage management aims to ensure availability for all users, with immediate access for requests below </span><span class="fontColorBlue" dir="ltr" lang="EN-AU"><strong>10TB</strong></span><span dir="ltr" lang="EN-AU"> for </span><span class="fontColorBlue" dir="ltr" lang="EN-AU"><strong>6 months</strong></span></p><p style="margin-left:0px;"><span dir="ltr" lang="EN-AU">If project space utilization approaches 70% capacity, the following measures will be considered to manage contention: </span>&nbsp;</p><ul><li><p style="margin-left:0px;"><span dir="ltr" lang="EN-AU">Inquiring if users can delay the initiation of their storage usage. </span>&nbsp;</p></li><li><p style="margin-left:0px;"><span dir="ltr" lang="EN-AU">Encouraging users to downsize their space usage or shorten their allocation duration. </span>&nbsp;</p></li><li><p style="margin-left:0px;"><span dir="ltr" lang="EN-AU">Advising the relocation of less frequently accessed data to other storage solutions. </span>&nbsp;</p></li><li><p style="margin-left:0px;"><span dir="ltr" lang="EN-AU">In extreme cases, denying new allocation requests to preserve system integrity. </span>&nbsp;</p></li></ul><p style="margin-left:0px;"><span dir="ltr" lang="EN-AU">Allocation requests are prioritized based on the performance benefits to users' projects, with the Research Computing Management Team adjudicating any appeals for prioritization based on scientific merit. </span>&nbsp;</p><h4 style="margin-left:0px;"><span class="fontColorBlue" dir="ltr" lang="EN-AU">Backup and snapshots</span></h4><p style="margin-left:0px;"><span dir="ltr" lang="EN-AU">Project allocations have a snapshot feature enabled.</span><span dir="ltr" lang="EN-US"> A snapshot is a reference point that preserves the exact folder structure and data content of a data path at a point in time. </span>These snapshots are taken daily and held for 7 days. Additionally, these recovering files from these snapshots is self service. Snapshots are stored in /vast/projects/.snapshot.</p><pre>$ ls /vast/projects/.snapshot<br><br>projects_2024-02-10_00_30_00_UTC  projects_2024-02-12_13_00_00_UTC<br>projects_2024-02-10_00_30_00_UTC  projects_2024-02-12_13_00_00_UTC<br>projects_2024-02-11_00_30_00_UTC  projects_2024-02-13_13_00_00_UTC<br>projects_2024-02-11_00_30_00_UTC  projects_2024-02-13_13_00_00_UTC<br>projects_2024-02-12_00_24_42_UTC  projects_2024-02-14_13_00_00_UTC<br>projects_2024-02-12_00_24_42_UTC  projects_2024-02-14_13_00_00_UTC<br><br># Each of these directories correspond to a date and time.<br># If you look inside one, you'll see a snapshot of the /vast/projects space at that time:<br>$ cd /vast/projects/.snapshot/projects_2024-02-10_00_30_00_UTC<br>$ ls<br><br>alphafold                   fearnleyl_ukbiobank  Pea_Deepsignal<br>AMD_RPD                     GLIMMER              PPCG<br>aspree                      Goel_senescence      PRIMO_PeterMac<br>bahlo_ataxia_collaboration  gtex_pon             project_area.sh<br>bahlo_cache                 haemEvo              Pu1_Project<br>...<br><br># to recover your files, simple copy them to a non-snapshot directory<br>$ cd RCP<br><br>$ pwd<br><br>/vast/projects/.snapshot/projects_2024-02-10_00_30_00_UTC/RCP<br><br>$ cp -r pubmed-landscape /vast/projects/RCP/pubmed-landscape-old</pre><p style="margin-left:0px;"><span dir="ltr" lang="EN-AU">Note that the snapshots are kept for only 7 days. So, it is the responsibility of the individual users to ensure that any data requiring longer-term retention/backup are manually moved to another managed storage. </span>&nbsp;</p><p style="margin-left:0px;"><span class="fontColorRedDark" dir="ltr" lang="EN-AU"><strong><u>Data stored on Projects will not be archived to tape storage automatically</u></strong><u>.  </u></span><span class="fontColorRedDark"><u>&nbsp;</u></span></p><h3><span class="fontColorThemeSecondary">Copying data</span></h3><p>When you start on your project you may need to stage input files into the project area and at the end of the project, you will need to copy the final output products back to your lab area. You can use <a href="https://download.samba.org/pub/rsync/rsync.1"><i>rsync</i></a>. Rsync has many advantages over <i><span class="fontColorBlue">cp</span></i>, including the ability to only copy data that does not exist in the target location and more flexibility in what data is copied.</p><p>Large copies (&gt;100GB) should be submitted to the batch system.</p><p>The following script can be used as a starting pointing point:</p><pre>rsync [OPTION...] SRC... [DEST]\n</pre><p>For example:</p><pre>rsync --verbose  --progress --compress  --recursive --times --perms  \\\n    --include input\\*.bam\n    /stornext/Projects/&lt;myproject&gt;/ \\\n    /vast/project/project-&lt;id&gt;/\n</pre><p>Instead of <i><span class="fontColorBlue">/stornext/Projects/myproject/</span></i>, use the projects folder path where you want to move the files from(source folder). Instead of <i><span class="fontColorBlue">/vast/project/project_000</span></i> use the projects folder path where you want to move files to (destination folder).</p>
<p><br><i><span class="fontColorThemeSecondary">​​​​​​​</span></i><span class="fontColorThemeSecondary">Use </span><i><span class="fontColorBlue"><strong>--dry-run</strong></span></i><span class="fontColorThemeSecondary"> to test your command without really running it, or copying any files. This option can give you an idea about which files will be copied and how many bytes will be copied.</span></p>
<p>Some useful <i><span class="fontColorBlue">rsync</span></i> options are as follows:</p><figure class="table canvasRteResponsiveTable" style="width:871px;" title="Table"><table class="filledHeaderTableStyleTheme ck-table-resized"><colgroup><col style="width:20.76%;"><col style="width:79.24%;"></colgroup><thead><tr><th style="width:170px;"><i><span class="fontColorYellowLight">rsync</span></i> Option</th><th style="width:649px;">Description</th></tr></thead><tbody><tr><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td><i><span class="fontColorBlue">--verbose</span></i></td><td>use verbose mode</td></tr><tr><td><i><span class="fontColorBlue">--progress</span></i></td><td>print information showing the progress of the transfer</td></tr><tr><td><i><span class="fontColorBlue">--compress</span></i></td><td>compress file data during the transfer</td></tr><tr><td><i><span class="fontColorBlue">--recursive</span></i></td><td>copy directories recursively</td></tr><tr><td><i><span class="fontColorBlue">--times</span></i></td><td>transfer modification times along with the files</td></tr><tr><td><i><span class="fontColorBlue">--perms</span></i></td><td>set the destination permissions to be the same as the source permissions</td></tr><tr><td><i><span class="fontColorBlue">--exclude=PATTERN</span></i></td><td>exclude files matching PATTERN</td></tr><tr><td><i><span class="fontColorBlue">--include=PATTERN</span></i></td><td>don't exclude files matching PATTERN</td></tr></tbody></table></figure><p>You can exclude certain files, for example, any file ending in bak, by adding <i><span class="fontColorBlue">--exclude "\\*bak"</span></i></p><p>To exclude multiple files or directories, you can use <i><span class="fontColorBlue">--exclude-from excludelist</span></i> where <i><span class="fontColorBlue">excludelist</span></i> is a txt file with all patterns you need to exclude. For example:</p><pre>*.bak\nlog\\\nlog*.txt\n</pre><p>This will exclude all files ending in <i><span class="fontColorBlue">.bak</span></i>, a directory called log and files starting with <i><span class="fontColorBlue">log</span></i> and ending in <i><span class="fontColorBlue">.txt</span></i>. The same can be done for <i><span class="fontColorBlue">--include-from</span></i> for including specific files or directories.</p><p>For more details on <i><span class="fontColorBlue">rsync</span></i>, go to <a href="https://rsync.samba.org/documentation.html" data-interception="off" target="_blank" rel="noopener noreferrer">rsync documentation</a>.</p><p>You can also wrap the command into a script and run in in the batch system, as follows</p><p><a href="/:u:/s/rc2/EX-ydjvQ_O1DnT8t-FwYWNMB9ag8SFNQp1fIlzm2DBWhKg?e=jnaqlw" data-interception="off" target="_blank" rel="noopener noreferrer">movedata.sh</a>, the script can also be found at</p><pre>/stornext/System/data/apps/sample-scripts/data_transfer/rsync.slurm\n</pre><pre>#!/bin/bash\n#SBATCH --job-name=movedata\n#SBATCH --output=movedata.out\n#SBATCH --error=movedata.err\n#SBATCH --time=24:00:00\n#SBATCH --nodes=1\n#SBACTH --cpus=1\n#SBATCH --mem=4GB\n\nrsync --verbose  --progress --compress  --recursive --times --perms  \\\n    --include input\\*.bam\n    /stornext/Projects/&lt;myproject&gt;/ \\\n    /vast/project/project-&lt;id&gt;/\n\necho "done"\n\n</pre><pre>sbatch movedata.sh\n</pre>
