<p>As described <a href="/sites/rc2/SitePages/Disk-quotas.aspx">in the Disk Quotas help page</a>, regular users have a home directory quote of 20 GB. If you install and run a lot of software, this can quickly get used up, and you will likely encounter the error “WARNING: dir soft quota exceeded.” On this page we will discuss some recommendations for cleaning up your home directory when this happens.</p>
<h2><span class="fontColorThemeSecondary">Analysing your Disk Usage</span></h2><p aria-hidden="true">&nbsp;</p><p>Before you clean anything up, it's a good idea to determine what is using a majority of your quota. To do this, we recommend using the dua tool. To run dua, start by doing the following:</p><p aria-hidden="true">&nbsp;</p><pre>module load dua-cli<br>dua interactive ~</pre><p>This will open an interactive window that starts scanning your home directory. After a few minutes, the word "Scanning" will disappear, and you can start to investigate your disk usage.</p><p>&nbsp;</p><p>You can navigate the window using:</p><ul><li>Up and down arrows to select a file or directory</li><li>Enter to expand the currently selected directory</li><li>Backspace to return to the previous directory</li></ul>
<p>Start by pressing enter to expand your home directory. You should then be presented with a screen that looks like this:</p><div class="imagePlugin" style="background-color:transparent;position:relative;" data-alignment="Center" data-imageurl="/sites/rc2/SiteAssets/SitePages/Home-Directory-Cleanup/427841867.png" data-overlaytextstyles="{&quot;textColor&quot;:&quot;light&quot;,&quot;isBold&quot;:false,&quot;isItalic&quot;:false,&quot;textBoxColor&quot;:&quot;dark&quot;,&quot;textBoxOpacity&quot;:0.54,&quot;overlayColor&quot;:&quot;light&quot;,&quot;overlayTransparency&quot;:0}" data-imagenaturalheight="1072" data-imagenaturalwidth="1664" data-siteid="93ee3842-f21b-4d8d-b85b-874e64c67802" data-webid="95711e2c-a16f-49a8-9adc-1b9756d4ee5e" data-listid="3d75202a-c480-42f5-abb7-5e7b39fc27d5" data-uniqueid="d3ff45ee-e5b6-479c-9899-7f7545496f26" data-height="258.0546875" data-width="400.5625" data-widthpercentage="100" data-uploading="0"></div><p aria-hidden="true">&nbsp;</p><p>In this screen, each row of the table shows one file or directory. The first column shows the disk usage of that file or all of its contents if it is a directory.</p><p aria-hidden="true">&nbsp;</p><p>From here, you can explore your home directory and try to identify the main culprits behind your disk usage. Then, refer to the next section for some tips on the best way to clean them all up.</p>
<h2><span class="fontColorThemeSecondary">Cleaning your Conda Cache</span></h2><p>If your <strong>~/.conda/pkgs</strong> directory is several GB or more, you should configure your conda cache. Although it isn't clear from its name, this directory contains a <i>cache </i>for packages, so it doesn't particularly matter what happens to this directory.</p><p aria-hidden="true">&nbsp;</p><p>The easiest way to clean up this cache is using the following commands:</p><pre>module load micromamba<br>micromamba clean --all</pre><p>Once this cache is cleaned, it is also recommended that you permanently move your cache to VAST scratch. To do so, <a href="/sites/rc2/SitePages/Conda-on-Milton.aspx#storing-downloaded-packages-on-vast-scratch">please follow the instructions here, under the section labelled 'Storing downloaded packages on VAST Scratch"</a>.</p>
<h2><span class="fontColorThemeSecondary">Stripping your R Packages</span></h2><p>If your R packages (generally stored in <strong>~/R</strong>) are several GB or more, you can reduce their size by stripping out the debug symbols from compiled binaries. This is safe to do, but will make it harder to debug errors that originate from C or C++ code. To strip the debug symbols, run the following command, replacing “4.2” with the appropriate version of R for which you want to reduce the package sizes:</p><pre>strip --strip-debug ~/R/x86_64-pc-linux-gnu-library/4.2/*/libs/*.so*</pre><p>Once this is complete, you can tell R to stop storing debug symbols in the future by running the following:</p><pre>mkdir -p ~/.R\necho 'LDFLAGS+=-s' &gt;&gt; ~/.R/Makevars\n</pre>
<h2><span class="fontColorThemeSecondary">Core Dumps</span></h2><p>If you have files in your home directory that are named <strong>core.XXXXX</strong>, for example “core.13472”, then you can safely delete them.&nbsp;</p><p>&nbsp;</p><p>These are Linux core dump files, <a href="https://man7.org/linux/man-pages/man5/core.5.html">which are explained in more detail here</a>. They are generally created when a process is terminated by the operating system, for example if you try to allocate more memory in R than your have requested from Slurm. In theory these files could be used to debug the error that caused the process to crash, but this is difficult to do correctly.</p>
<h2><span class="fontColorThemeSecondary">Large Conda Environments</span></h2><p>If you have large conda environments, then your <strong>~/.conda/envs</strong> may be several gigabytes. To avoid this happening, you can move your environments directory to a VAST space, <a href="/sites/rc2/SitePages/Conda-on-Milton.aspx#storing-your-environments">as explained here</a>.</p>
