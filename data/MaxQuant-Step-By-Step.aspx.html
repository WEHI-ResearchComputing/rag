<h2>MaxQuant step-by-step</h2><p>This step-by-step tutorial details how to set your job up through an MSCypher VM and then run it on SLURM. This has&nbsp;the following advantages over running on the VM:<br><br></p><ul><li>More CPU cores and memory available through<strong> </strong><a href="/sites/rc2/SitePages/Batch-jobs.aspx" data-cke-saved-href="https://wehieduau.sharepoint.com/sites/rc2/SitePages/Batch-jobs.aspx" data-interception="on" title="https://wehieduau.sharepoint.com/sites/rc2/SitePages/Batch-jobs.aspx">SLURM</a></li><li>MaxQuant runs faster on Linux, as documented in <a href="https://www.nature.com/articles/s41592-018-0018-y" data-cke-saved-href="https://www.nature.com/articles/s41592-018-0018-y" target="_blank" data-interception="off" title="https://www.nature.com/articles/s41592-018-0018-y">this <em>Nature</em> paper</a></li><li><strong>​​​​​​​</strong>Using SLURM, you can copy your data to <a href="/sites/rc2/SitePages/high-performance-storage.aspx" data-cke-saved-href="https://wehieduau.sharepoint.com/sites/rc2/SitePages/high-performance-storage.aspx" target="_blank" data-interception="off" title="https://wehieduau.sharepoint.com/sites/rc2/SitePages/high-performance-storage.aspx">VAST</a> and get faster I/O performance</li></ul>
<h3><span class="fontColorBlue">Step 1: Prepare your data</span></h3><p>You must know where your data is stored.&nbsp;Most proteomics data is stored&nbsp;in:</p><pre style="margin-left:40px;"><span class="fontColorBlue">S:\\data\\Projects\\ProteomicsLab\\DATA</span></pre><p>on the MSCypher VM which maps to:</p><pre style="margin-left:40px;"><span class="fontColorBlue">/stornext/Sysbio/data/Projects/ProteomicsLab/DATA</span></pre><p>Ensure that your project directory contains:</p><ul><li>all input data</li><li>reference fasta file</li><li>XML file.</li></ul>
<p><strong><span class="fontColorRed">Note</span></strong> that the project directory should only have MQ related file, any files from an old run may conflict with the new run and cause <span class="fontColorBlue"><strong>errors</strong></span></p>
<h3><span class="fontColorBlue">Step 2: Set up MaxQuant parameters</span></h3><p>Using your MSCypher VM, open MaxQuant and load your input files:</p><div tabindex="-1" data-cke-widget-wrapper="1" data-cke-filter="off" class="cke_widget_wrapper cke_widget_block cke_widget_inlineimage cke_widget_wrapper_webPartInRteInlineImage cke_widget_wrapper_webPartInRteAlignCenter cke_widget_wrapper_webPartInRte" data-cke-display-name="div" data-cke-widget-id="1" role="region" aria-label="Inline image in RTE. Use Alt + F11 to go to toolbar. Use Alt + P to open the property pane."><div data-webpart-id="image" class="webPartInRte webPartInRteAlignCenter webPartInRteInlineImage cke_widget_element" data-cke-widget-data="%7B%22classes%22%3A%7B%22webPartInRteInlineImage%22%3A1%2C%22webPartInRteAlignCenter%22%3A1%2C%22webPartInRte%22%3A1%7D%7D" data-cke-widget-upcasted="1" data-cke-widget-keep-attr="0" data-widget="inlineimage" data-instance-id="e7b51c78-42ca-4fb6-8f40-90ac3d621f3c" title=""></div></div><p>Make sure you save all changes made to the XML file, saved in the same directory as your data.</p>
<h3><span class="fontColorBlue">Optional step: Move your project data to VAST</span></h3><p>It is recommended that you request a <a href="/sites/rc2/SitePages/high-performance-storage.aspx" data-cke-saved-href="https://wehieduau.sharepoint.com/sites/rc2/SitePages/high-performance-storage.aspx" data-interception="on" title="https://wehieduau.sharepoint.com/sites/rc2/SitePages/high-performance-storage.aspx">VAST scratch</a> space where you can run your jobs and then move the results back to your shared location on Sysbio. Running on VAST can accelerate your job runs, especially with repeated read/write operations.</p><p>To request a VAST scratch space, login to <a href="https://ondemand.hpc.wehi.edu.au/" data-cke-saved-href="https://ondemand.hpc.wehi.edu.au/" target="_blank" data-interception="off" title="https://ondemand.hpc.wehi.edu.au/">Open Ondemand</a><strong>. </strong>Using the <em>Files</em> menu, as shown below, navigate to your Home directory:</p><div tabindex="-1" data-cke-widget-wrapper="1" data-cke-filter="off" class="cke_widget_wrapper cke_widget_block cke_widget_inlineimage cke_widget_wrapper_webPartInRteInlineImage cke_widget_wrapper_webPartInRteAlignCenter cke_widget_wrapper_webPartInRte" data-cke-display-name="div" data-cke-widget-id="9" role="region" aria-label="Inline image in RTE. Use Alt + F11 to go to toolbar. Use Alt + P to open the property pane."><div data-webpart-id="image" class="webPartInRte webPartInRteAlignCenter webPartInRteInlineImage cke_widget_element" data-cke-widget-data="%7B%22classes%22%3A%7B%22webPartInRteInlineImage%22%3A1%2C%22webPartInRteAlignCenter%22%3A1%2C%22webPartInRte%22%3A1%7D%7D" data-cke-widget-upcasted="1" data-cke-widget-keep-attr="0" data-widget="inlineimage" data-instance-id="2f9f8605-be30-4b91-a8e7-e7a98e61782b" title=""></div></div><p>In this example, we assume that the project we are interested in is stored here:</p><pre style="margin-left:40px;"><span class="fontColorBlue">/stornext/Sysbio/data/Projects/ProteomicsLab/DATA/P4023</span></pre><p>So, we use <em>Change Directory</em> (as shown below) to go to where the directory is:</p><div tabindex="-1" data-cke-widget-wrapper="1" data-cke-filter="off" class="cke_widget_wrapper cke_widget_block cke_widget_inlineimage cke_widget_wrapper_webPartInRteInlineImage cke_widget_wrapper_webPartInRteAlignCenter cke_widget_wrapper_webPartInRte" data-cke-display-name="div" data-cke-widget-id="8" role="region" aria-label="Inline image in RTE. Use Alt + F11 to go to toolbar. Use Alt + P to open the property pane."><div data-webpart-id="image" class="webPartInRte webPartInRteAlignCenter webPartInRteInlineImage cke_widget_element" data-cke-widget-data="%7B%22classes%22%3A%7B%22webPartInRteInlineImage%22%3A1%2C%22webPartInRteAlignCenter%22%3A1%2C%22webPartInRte%22%3A1%7D%7D" data-cke-widget-upcasted="1" data-cke-widget-keep-attr="0" data-widget="inlineimage" data-instance-id="ee5de946-50dd-4fe5-9a90-0969ad0782ac" title=""></div></div><p>We can copy files between directories through the <span class="fontColorBlue"><em>Copy/Move</em> <span class="fontColorNeutralDark">button</span></span> but this is not recommended for big directories, so this is how to move through the terminal:</p><p>Use the <span class="fontColorBlue"><em>Open in Terminal</em> <span class="fontColorNeutralDark">button</span></span><strong><span class="fontColorBlue">&nbsp;</span></strong>to open a terminal in another tab of your browser.</p><div tabindex="-1" data-cke-widget-wrapper="1" data-cke-filter="off" class="cke_widget_wrapper cke_widget_block cke_widget_inlineimage cke_widget_wrapper_webPartInRteInlineImage cke_widget_wrapper_webPartInRteAlignCenter cke_widget_wrapper_webPartInRte" data-cke-display-name="div" data-cke-widget-id="7" role="region" aria-label="Inline image in RTE. Use Alt + F11 to go to toolbar. Use Alt + P to open the property pane."><div data-webpart-id="image" class="webPartInRte webPartInRteAlignCenter webPartInRteInlineImage cke_widget_element" data-cke-widget-data="%7B%22classes%22%3A%7B%22webPartInRteInlineImage%22%3A1%2C%22webPartInRteAlignCenter%22%3A1%2C%22webPartInRte%22%3A1%7D%7D" data-cke-widget-upcasted="1" data-cke-widget-keep-attr="0" data-widget="inlineimage" data-instance-id="64680d0a-0904-4a7e-94a2-99b6a816ad72" title=""></div></div><p>You will&nbsp;be asked for your WEHI&nbsp;password. Don't worry if nothing appears as you enter your password as this is how Linux deals with passwords.</p><div tabindex="-1" data-cke-widget-wrapper="1" data-cke-filter="off" class="cke_widget_wrapper cke_widget_block cke_widget_inlineimage cke_widget_wrapper_webPartInRteInlineImage cke_widget_wrapper_webPartInRteAlignCenter cke_widget_wrapper_webPartInRte" data-cke-display-name="div" data-cke-widget-id="6" role="region" aria-label="Inline image in RTE. Use Alt + F11 to go to toolbar. Use Alt + P to open the property pane."><div data-webpart-id="image" class="webPartInRte webPartInRteAlignCenter webPartInRteInlineImage cke_widget_element" data-cke-widget-data="%7B%22classes%22%3A%7B%22webPartInRteInlineImage%22%3A1%2C%22webPartInRteAlignCenter%22%3A1%2C%22webPartInRte%22%3A1%7D%7D" data-cke-widget-upcasted="1" data-cke-widget-keep-attr="0" data-widget="inlineimage" data-instance-id="e6783eff-77c6-483b-bd02-1057cb352d8f" title=""></div></div><p>Then run the two commands&nbsp;below and wait until the command finishes. This may take a few seconds, minutes, or hours depending on the amount of data moved.&nbsp;</p><pre style="margin-left:40px;"><span class="fontColorBlue">cd ../ \ncp -r P4023 /vast/scratch/users/$USER/</span></pre><p><br></p><div tabindex="-1" data-cke-widget-wrapper="1" data-cke-filter="off" class="cke_widget_wrapper cke_widget_block cke_widget_inlineimage cke_widget_wrapper_webPartInRteInlineImage cke_widget_wrapper_webPartInRteAlignCenter cke_widget_wrapper_webPartInRte" data-cke-display-name="div" data-cke-widget-id="5" role="region" aria-label="Inline image in RTE. Use Alt + F11 to go to toolbar. Use Alt + P to open the property pane."><div data-webpart-id="image" class="webPartInRte webPartInRteAlignCenter webPartInRteInlineImage cke_widget_element" data-cke-widget-data="%7B%22classes%22%3A%7B%22webPartInRteInlineImage%22%3A1%2C%22webPartInRteAlignCenter%22%3A1%2C%22webPartInRte%22%3A1%7D%7D" data-cke-widget-upcasted="1" data-cke-widget-keep-attr="0" data-widget="inlineimage" data-instance-id="c0895220-d974-41d0-abcb-60922cd5a48e" title=""></div></div><p>The image above shows an example where I move the project to my VAST scratch directory. Replace username <em>iskander.j </em>with yours when running, or any alternative path you want to move to. Then continue to <em>Step 3</em>, using the path you saved the data to.</p>
<h3><span class="fontColorBlue">Step 3: Start a job on SLURM</span></h3><p>Using the <em>Change Directory</em> button (as shown above) go to your project directory (whether on VAST/Stornext) and create a new file called <em>mq.slurm</em>, for example.</p><div tabindex="-1" data-cke-widget-wrapper="1" data-cke-filter="off" class="cke_widget_wrapper cke_widget_block cke_widget_inlineimage cke_widget_wrapper_webPartInRteInlineImage cke_widget_wrapper_webPartInRteAlignCenter cke_widget_wrapper_webPartInRte" data-cke-display-name="div" data-cke-widget-id="3" role="region" aria-label="Inline image in RTE. Use Alt + F11 to go to toolbar. Use Alt + P to open the property pane."><div data-webpart-id="image" class="webPartInRte webPartInRteAlignCenter webPartInRteInlineImage cke_widget_element" data-cke-widget-data="%7B%22classes%22%3A%7B%22webPartInRteInlineImage%22%3A1%2C%22webPartInRteAlignCenter%22%3A1%2C%22webPartInRte%22%3A1%7D%7D" data-cke-widget-upcasted="1" data-cke-widget-keep-attr="0" data-widget="inlineimage" data-instance-id="8e46b86e-ed9f-496e-9129-fc37f2d769b9" title=""></div></div><p>Then find the new file, click the 3 dot dropdown icon next to it, and select <em>edit</em>.</p><div tabindex="-1" data-cke-widget-wrapper="1" data-cke-filter="off" class="cke_widget_wrapper cke_widget_block cke_widget_inlineimage cke_widget_wrapper_webPartInRteInlineImage cke_widget_wrapper_webPartInRteAlignCenter cke_widget_wrapper_webPartInRte" data-cke-display-name="div" data-cke-widget-id="2" role="region" aria-label="Inline image in RTE. Use Alt + F11 to go to toolbar. Use Alt + P to open the property pane."><div data-webpart-id="image" class="webPartInRte webPartInRteAlignCenter webPartInRteInlineImage cke_widget_element" data-cke-widget-data="%7B%22classes%22%3A%7B%22webPartInRteInlineImage%22%3A1%2C%22webPartInRteAlignCenter%22%3A1%2C%22webPartInRte%22%3A1%7D%7D" data-cke-widget-upcasted="1" data-cke-widget-keep-attr="0" data-widget="inlineimage" data-instance-id="c34ca1aa-94bf-491d-bc09-0e2f80142bc4" title=""></div></div><p>And copy and paste the script below to the file and save.</p>
<pre>#!/bin/bash\n\n#SBATCH -p regular\n#SBATCH --job-name=<span class="highlightColorAqua">MQ</span>\n#SBATCH --time=<span class="highlightColorAqua">48:00:00</span>\n#SBATCH --cpus-per-task=<span class="highlightColorAqua">10</span>\n#SBATCH --mem=<span class="highlightColorAqua">20G</span>\n\nnumthreads=<span class="highlightColorAqua">9</span>\n\nmodule load &nbsp;MaxQuant/2.0.2.0\n\n## MQcreateMQXML will create a new mqpar.mod.xml with updated list&nbsp;\n## And also modify thread\n## location of command will be changed after testing is completed\n</pre><pre>/stornext/System/data/apps/rc-tools/rc-tools-1.0/bin/tools/MQ/createMQXML.py $numthread \n\nMaxQuant mqpar.mod.xml</pre>
<p>The highlighted parts in the script can be changed according to your dataset size.&nbsp;<br>So for a small dataset (smaller number of input files ~5-10 files), you can use less <em>--cpus-per-task</em> and less <em>--mem</em>. The number of threads is also important, so if you want to use the number of threads equal to the number of input files use:</p><pre style="margin-left:40px;">numthreads=0\n</pre>
<p>Then click on the <span class="fontColorBlue">Open in Terminal<strong><span class="fontColorBlue"> </span></strong><span class="fontColorNeutralDark">button</span></span> and run:</p><pre style="margin-left:40px;">sbatch mq.slurm</pre><p>This will start a Slurm job that will run your MaxQuant task. Depending on the state of the queue, your job might start running immediately or may get queued up until resources are available. Keep an eye on the <a href="http://dashboards.hpc.wehi.edu.au/d/s/slurm?orgId=1&amp;refresh=10s" data-cke-saved-href="http://dashboards.hpc.wehi.edu.au/d/s/slurm?orgId=1&amp;refresh=10s" target="_blank" data-interception="off" title="http://dashboards.hpc.wehi.edu.au/d/s/slurm?orgId=1&amp;refresh=10s">SLURM Dashboards</a>.</p>
<p>Add the following lines below to</p><pre style="margin-left:40px;">MaxQuant mqpar.mod.xml</pre><p>to ensure deletion of&nbsp;any files/folders not required by the run</p><pre>##Older processed files are removed\nfind ./ -type f -not -regex '.*\\.\\(slurm\\|fasta\\|xml\\|out\\)' -maxdepth 1 -mindepth 1 -delete\nfind ./ -type d -not -regex '.*\\.\\(d\\)' -maxdepth 1 -mindepth 1 -exec rm -rf "{}" \\</pre>
<ol><li><span class="fontColorBlue">Make sure your folder contains all required files, fast, input, and XML files</span></li><li><span class="fontColorBlue">​​​​​​​According to the recommendation in </span><a title="http://www.coxdocs.org/doku.php?id=maxquant:common:download_and_installation" data-interception="off" data-cke-saved-href="http://www.coxdocs.org/doku.php?id=maxquant:common:download_and_installation" href="http://www.coxdocs.org/doku.php?id=maxquant:common:download_and_installation" target="_blank">MaxQuant's documentation</a><span class="fontColorBlue"><span>, the minimum memory&nbsp;required is&nbsp;</span></span><span class="fontColorBlue"><strong><em>4 GB</em></strong></span></li></ol>
<h3><span class="fontColorBlue">Step 4: Monitor your job</span></h3><p>You can check the status of your jobs on the <strong><a href="http://dashboards.hpc.wehi.edu.au/d/jobdetails/user-queue-details" data-cke-saved-href="http://dashboards.hpc.wehi.edu.au/d/jobdetails/user-queue-details" target="_blank" data-interception="off" title="http://dashboards.hpc.wehi.edu.au/d/jobdetails/user-queue-details">Users Queue Details dashboard</a>. </strong>Select your username from the <em>Users</em> dropdown menu to see how many jobs you have running/pending and the amount of resources you requested. To learn more about SLURM, please visit our <a href="/sites/rc2/SitePages/Batch-jobs.aspx" data-cke-saved-href="https://wehieduau.sharepoint.com/sites/rc2/SitePages/Batch-jobs.aspx" target="_blank" data-interception="off" title="https://wehieduau.sharepoint.com/sites/rc2/SitePages/Batch-jobs.aspx">batch jobs</a> page.</p><div tabindex="-1" data-cke-widget-wrapper="1" data-cke-filter="off" class="cke_widget_wrapper cke_widget_block cke_widget_inlineimage cke_widget_wrapper_webPartInRteInlineImage cke_widget_wrapper_webPartInRteAlignCenter cke_widget_wrapper_webPartInRte" data-cke-display-name="div" data-cke-widget-id="1" role="region" aria-label="Inline image in RTE. Use Alt + F11 to go to toolbar. Use Alt + P to open the property pane."><div data-webpart-id="image" class="webPartInRte webPartInRteAlignCenter webPartInRteInlineImage cke_widget_element" data-cke-widget-data="%7B%22classes%22%3A%7B%22webPartInRteInlineImage%22%3A1%2C%22webPartInRteAlignCenter%22%3A1%2C%22webPartInRte%22%3A1%7D%7D" data-cke-widget-upcasted="1" data-cke-widget-keep-attr="0" data-widget="inlineimage" data-instance-id="9a1fae41-2e05-43b7-9fe0-32d6faf14380" title=""></div></div>
<p>To run <strong><span class="fontColorBlue">partial processing</span></strong> modify mq.slurm&nbsp; by changing this line</p><pre style="margin-left:40px;">MaxQuant mqpar.mod.xml</pre><p>to&nbsp;</p><pre style="margin-left:40px;">MaxQuant -p <em>start</em> -e <em>end</em> mqpar.mod.xml</pre><p>where <em>start</em> is the job id to start processing and end is the <em>end</em> job id. This can be used to continue/redo parts of the processing. Job id's can be obtained in the MaxQuant GUI partial processing view or<br>from --dryrun option. The first job id is 1.&nbsp;1-based indexing is used.</p><p><br></p>
