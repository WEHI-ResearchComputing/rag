<h2>Accessing Cloudstor</h2><p><span class="fontColorRed">AARNET, who currently host Cloudstor, have announced the service will be decommissioned on Friday 15 December 2023, therefore, we recommend its use for short term projects ONLY. For the full announcement see</span>&nbsp;<a data-cke-saved-href="https://support.aarnet.edu.au/hc/en-us/articles/5697089309711-Decommissioning-CloudStor-" href="https://support.aarnet.edu.au/hc/en-us/articles/5697089309711-Decommissioning-CloudStor-" title="https://support.aarnet.edu.au/hc/en-us/articles/5697089309711-Decommissioning-CloudStor-">https://support.aarnet.edu.au/hc/en-us/articles/5697089309711-Decommissioning-CloudStor-</a><br></p><h4>Contents of this article demonstrate three different ways to access cloudstor.</h4><ol></ol><p><span class="fontColorRed"><em>DO NOT USE FOR SENSITIVE DATA OR DATA THAT YOU ARE CONTRACTUALLY OBLIGED TO DELTE. EVEN IF IT IS DELETED FROM CLOUDSTOR IT IS BACKED UP IN THEIR SYSTEM SO ITS NEVER TRULY DELETED -&nbsp;</em></span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><em><span><span><span><a data-cke-saved-href="https://support.aarnet.edu.au/hc/en-us/articles/360001299376-CloudStor-Service-Offering" href="https://support.aarnet.edu.au/hc/en-us/articles/360001299376-CloudStor-Service-Offering" title="https://support.aarnet.edu.au/hc/en-us/articles/360001299376-CloudStor-Service-Offering" data-interception="on">https://support.aarnet.edu.au/hc/en-us/articles/360001299376-CloudStor-Service-Offering</a></span></span></span></em></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p><p><br></p><p><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span>To access cloudstor you will need to make sure that you have a cloudstor account and you have an app password.</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p><p>The function of each of the APIs is limited so you may have to use a combination of them to achieve everything you need to achieve.</p><p style="text-align:start;"><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span>Log in to Cloudstor and sign up with your WEHI email address, account will be ready to go.</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><br><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span>You will need your Cloudstor username (WEHI email) and password to use the API, however it is not your regular cloudstor password. You will need to create an app password by following these steps - </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><a href="https://support.aarnet.edu.au/hc/en-us/articles/236034707-How-do-I-manage-change-my-passwords-" data-cke-saved-href="https://support.aarnet.edu.au/hc/en-us/articles/236034707-How-do-I-manage-change-my-passwords-" data-interception="on" title="https://support.aarnet.edu.au/hc/en-us/articles/236034707-How-do-I-manage-change-my-passwords-">https://support.aarnet.edu.au/hc/en-us/articles/236034707-How-do-I-manage-change-my-passwords-</a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p><p style="text-align:start;">Just the code blocks can be found in the GitHub below.</p><p style="text-align:start;"><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><a data-cke-saved-href="https://github.com/WEHI-ResearchComputing/accessing_cloudstor" href="https://github.com/WEHI-ResearchComputing/accessing_cloudstor">https://github.com/WEHI-ResearchComputing/accessing_cloudstor</a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p>
<h3>Using the CLI</h3><p><a data-cke-saved-href="https://support.aarnet.edu.au/hc/en-us/articles/220990167-Use-CloudStor-from-the-command-line" href="https://support.aarnet.edu.au/hc/en-us/articles/220990167-Use-CloudStor-from-the-command-line">https://support.aarnet.edu.au/hc/en-us/articles/220990167-Use-CloudStor-from-the-command-line</a></p><p style="text-align:start;"><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span>Follow the steps below to setup rclone to connect with cloudstor from your slurm cli</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p><p style="text-align:start;"><br></p><ul><li style="margin-left:8px;"><span><span>Module load rclone</span></span></li><li style="margin-left:8px;"><span><span>Type in rclone config</span></span></li><li style="margin-left:8px;"><span><span>n</span></span></li><li style="margin-left:8px;"><span><span>Enter Cloudstor as name</span></span></li><li style="margin-left:8px;"><span><span>Enter webdav for storage&nbsp;</span></span></li><li style="margin-left:8px;"><span><span>Copy webdav address and paste in url prompt (cloudstor site -&gt; settings)</span></span></li><li style="margin-left:8px;"><p><br></p><div tabindex="-1" data-cke-widget-wrapper="1" data-cke-filter="off" class="cke_widget_wrapper cke_widget_block cke_widget_inlineimage cke_widget_wrapper_webPartInRteInlineImage cke_widget_wrapper_webPartInRteAlignLeft cke_widget_wrapper_webPartInRte" data-cke-display-name="div" data-cke-widget-id="1" role="region" aria-label="Inline image in RTE. Use Alt + F11 to go to toolbar. Use Alt + P to open the property pane."><div data-webpart-id="image" data-indentation-levels="1" class="webPartInRte webPartInRteAlignLeft webPartInRteInlineImage cke_widget_element" data-cke-widget-data="%7B%22classes%22%3A%7B%22webPartInRteInlineImage%22%3A1%2C%22webPartInRteAlignLeft%22%3A1%2C%22webPartInRte%22%3A1%7D%7D" data-cke-widget-upcasted="1" data-cke-widget-keep-attr="0" data-widget="inlineimage" data-instance-id="64c31b0f-fcd5-4a4d-b1c8-294bb82ccfaf" title=""></div></div></li><li style="margin-left:8px;"><span><span>ownCloud in vendor prompt</span></span></li><li style="margin-left:8px;"><span><span>enter institute email in user as that is your cloudstor name as well</span></span></li><li style="margin-left:8px;"><span><span>enter your app password (created above) twice to confirm it</span></span></li><li style="margin-left:8px;"><span><span>click enter at the bearer_token prompt</span></span></li><li style="margin-left:8px;"><span><span>then n for advanced config</span></span></li><li style="margin-left:8px;"><span><span>confirm details are correct then quit config</span></span></li></ul><p style="margin-left:8px;"><br></p><p style="text-align:start;"><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span>To view files&nbsp;</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p><pre>rclone ls CloudStor:/test</pre><p style="text-align:start;"><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span>To copy files between locations&nbsp;</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p><pre>rclone copy &lt;source&gt; &lt;destination&gt;</pre><p style="text-align:start;"><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span>for example to copy from the test folder in cloudstor to a local test folder on ondemand use could use the following</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p><pre>rclone copy CloudStor:/test ./test/\n</pre><p style="text-align:start;"><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span>There are optional parameters that you can use</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p><ul><li><span><span><span><span><span>--progress</span></span></span><span><span><span><span>: See real-time updates on how the file copying is progressing.</span></span></span></span></span></span></li><li><span><span><span><span><span><span>--transfers &lt;number&gt;</span></span></span></span><span><span><span><span>: Specify how many files can be copied at the same time. The default is 4.</span></span></span></span></span></span></li><li><span><span><span><span><span><span>--create-empty-src-dirs</span></span></span></span><span><span><span><span>: If you want rclone to preserve the folder structure from the source, even if folders are currently empty.</span></span></span></span></span></span></li><li><span><span><span><span><span><span>--checkers &lt;number&gt;</span></span></span></span><span><span><span><span>: Specify how many files and folders rclone can check for updates at once. The default is 8.</span></span></span></span></span></span></li></ul><p style="text-align:start;"><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span>Using parameters example:</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p><pre>rclone copy --progress --transfers 8 CloudStor:/test ./test/</pre>
<h4>Table of Contents</h4><ol><li>Using the CLI</li><li>Using RStudio</li><li>Using Jupyter Notebook</li></ol>
<h3>Using RStudio</h3><p><a data-cke-saved-href="https://github.com/pdparker/cloudstoR  You may have to install some axillary packages for cloudstoR to work The connection to cloudstor can sometimes be dodgy, if you have followed the instructions and get stuck giving a 403/401 error, keep trying the command it should work at some point. " href="https://github.com/pdparker/cloudstoRYou%20may%20have%20to%20install%20some%20axillary%20packages%20for%20cloudstoR%20to%20workThe%20connection%20to%20cloudstor%20can%20sometimes%20be%20dodgy%2c%20if%20you%20have%20followed%20the%20instructions%20and%20get%20stuck%20giving%20a%20403/401%20error%2c%20keep%20trying%20the%20command%20it%20should%20work%20at%20some%20point.">https://github.com/pdparker/cloudstoR </a></p><p>Tested and working for RStudio v 4.2.1</p><p>You may have to install some axillary packages for cloudstoR to work The connection to cloudstor can sometimes be dodgy, if you have followed the instructions and get stuck giving a 403/401 error, keep trying the command it should work at some point.</p><p>Open your RStudio session and enter the following</p><pre style="text-align:start;"><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span>install.packages(</span><span>"cloudstoR"</span><span>)</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>\n</pre><pre style="text-align:start;"><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span>library(cloudstoR)</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></pre><p style="text-align:start;"><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span>This will have downloaded and loaded cloudstoR into your R session.&nbsp;</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><br><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span>To authenticate yourself use the following command and enter your username and password when prompted, this will stop you needing to enter it everytime you call a function. You can use this again to reset your name and password. If you need to revoke your app password you can use reset_keys=TRUE which removes the authentication.</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p><pre style="text-align:start;"><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span>cloud_auth()or cloud_auth(</span><span>reset_keys=</span><span>TRUE</span><span>)'</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></pre><p><br></p><p style="text-align:start;"><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span>To list the data found in your cloudstor account use the following:</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p><pre style="text-align:start;"><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span>cloud_list(</span><span>path =</span> <span>'cloudstoR Tests'</span><span>)</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></pre><pre style="text-align:start;"><span><span><span><span><span><span><span><span><span><span><span><span><span><span><i><span><span><span><span>#&gt; [1] "Another Folder/" "mydata1.csv"&nbsp;&nbsp;&nbsp;&nbsp; "mydata2.csv"</span></span></span></span></i></span></span></span></span></span></span></span></span></span></span></span></span></span></span></pre><p style="text-align:start;"><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span>To retrieve a specific file from cloudstor use the cloud_get() function and provide the correct path to the file. This will read the file to memory not download it to the system.</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p><pre style="text-align:start;"><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span>my_data &lt;-</span> <span>cloud_get(</span><span>path =</span> <span>'cloudstoR Tests/mydata1.csv')</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></pre><pre style="text-align:start;"><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span>my_data</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></pre><pre style="text-align:start;"><span><span><span><span><span><span><span><span><span><span><span><span><span><span><i><span><span><span><span>#&gt;&nbsp;&nbsp; A&nbsp; B&nbsp; C</span></span></span></span></i></span></span></span></span></span></span></span></span></span></span></span></span></span></span></pre><pre style="text-align:start;"><span><span><span><span><span><span><span><span><span><span><span><span><span><span><i><span><span><span><span>#&gt; 1 3 10&nbsp; 8</span></span></span></span></i></span></span></span></span></span></span></span></span></span></span></span></span></span></span></pre><pre style="text-align:start;"><span><span><span><span><span><span><span><span><span><span><span><span><span><span><i><span><span><span><span>#&gt; 2 5&nbsp; 7&nbsp; 5</span></span></span></span></i></span></span></span></span></span></span></span></span></span></span></span></span></span></span></pre><pre style="text-align:start;"><span><span><span><span><span><span><span><span><span><span><span><span><span><span><i><span><span><span><span>#&gt; 3 5&nbsp; 7 10</span></span></span></span></i></span></span></span></span></span></span></span></span></span></span></span></span></span></span></pre><p><br></p><p style="text-align:start;"><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span>Accessing a private file that has been sent as a link can be accessed with the cloud_get() command as well. However, a dest parameter has to be provided</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p><pre style="text-align:start;"><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span>my_data &lt;-</span> <span>cloud_get(</span><span>path =</span> <span>“cloudstor link to file”, password=”supplied password”, dest=”file name”</span><span>)</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></pre><pre style="text-align:start;"><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span>my_data</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></pre><pre style="text-align:start;"><span><span><span><span><span><span><span><span><span><span><span><span><span><span><i><span>#&gt;&nbsp;&nbsp; A&nbsp; B&nbsp; C</span></i></span></span></span></span></span></span></span></span></span></span></span></span></span></span></pre><pre style="text-align:start;"><span><span><span><span><span><span><span><span><span><span><span><span><span><span><i><span>#&gt; 1 3 10&nbsp; 8</span></i></span></span></span></span></span></span></span></span></span></span></span></span></span></span></pre><pre style="text-align:start;"><span><span><span><span><span><span><span><span><span><span><span><span><span><span><i><span>#&gt; 2 5&nbsp; 7&nbsp; 5</span></i></span></span></span></span></span></span></span></span></span></span></span></span></span></span></pre><pre style="text-align:start;"><span><span><span><span><span><span><span><span><span><span><span><span><span><span><i><span>#&gt; 3 5&nbsp; 7 10</span></i></span></span></span></span></span></span></span></span></span></span></span></span></span></span></pre><p><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span>To save a local file to cloudstor navigate to the Choose Directory menu option and find where your local file is held, or have the path to it to add to the command. The use the cloud_put command to add the file to your cloudstor account.</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>​​​​​​​</p><div tabindex="-1" data-cke-widget-wrapper="1" data-cke-filter="off" class="cke_widget_wrapper cke_widget_block cke_widget_inlineimage cke_widget_wrapper_webPartInRteInlineImage cke_widget_wrapper_webPartInRteAlignCenter cke_widget_wrapper_webPartInRte" data-cke-display-name="div" data-cke-widget-id="3" role="region" aria-label="Inline image in RTE. Use Alt + F11 to go to toolbar. Use Alt + P to open the property pane."><div data-webpart-id="image" class="webPartInRte webPartInRteAlignCenter webPartInRteInlineImage cke_widget_element" data-cke-widget-data="%7B%22classes%22%3A%7B%22webPartInRteInlineImage%22%3A1%2C%22webPartInRteAlignCenter%22%3A1%2C%22webPartInRte%22%3A1%7D%7D" data-cke-widget-upcasted="1" data-cke-widget-keep-attr="0" data-widget="inlineimage" data-instance-id="c0975997-9a5b-403c-8c9e-d1460ca0ac53" title=""></div></div><p><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span>​​​​​​​</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p><pre style="text-align:start;"><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span>cloud_put(</span><span>local_file =</span> <span>'~/datatosave.sav'</span><span>,</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></pre><pre style="text-align:start;"><span><span><span><span><span><span><span><span><span><span><span><span><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span>path =</span> <span>'additional/path/to/folder'</span><span>,</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></pre><pre style="text-align:start;"><span><span><span><span><span><span><span><span><span><span><span><span><span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span>file_name =</span> <span>'mydata.sav'</span><span>)</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></pre><p><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span>If you're not sure where the file you require is, use the cloud_browse() function and navigate the menus using the number keys as shown.</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p><div tabindex="-1" data-cke-widget-wrapper="1" data-cke-filter="off" class="cke_widget_wrapper cke_widget_block cke_widget_inlineimage cke_widget_wrapper_webPartInRteInlineImage cke_widget_wrapper_webPartInRteAlignCenter cke_widget_wrapper_webPartInRte" data-cke-display-name="div" data-cke-widget-id="2" role="region" aria-label="Inline image in RTE. Use Alt + F11 to go to toolbar. Use Alt + P to open the property pane."><div data-webpart-id="image" class="webPartInRte webPartInRteAlignCenter webPartInRteInlineImage cke_widget_element" data-cke-widget-data="%7B%22classes%22%3A%7B%22webPartInRteInlineImage%22%3A1%2C%22webPartInRteAlignCenter%22%3A1%2C%22webPartInRte%22%3A1%7D%7D" data-cke-widget-upcasted="1" data-cke-widget-keep-attr="0" data-widget="inlineimage" data-instance-id="137a2326-fc80-47dc-8796-d06a0eb61043" title=""></div></div><p style="text-align:start;"><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span>You can view the meta data of a file using the cloud_meta() command</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p><pre>cloud_meta(path = 'cloudstoR Tests/mydata1.csv')\n\n#&gt;                                             file_name\n\n#&gt; 1 /plus/remote.php/webdav/cloudstoR Tests/mydata1.csv\n\n#&gt;                                  tag                 file_modified file_size\n\n#&gt; 1 "9a2a8fdd58a6c2746cd65b7dace6115c" Sun, 16 Jan 2022 05:42:52 GMT        36</pre>
<h3>Using Jupyter Notebooks</h3><p style="text-align:start;"><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span>You will need start a conda environment with the following</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;in your cli</p><pre>module load anaconda3\n\nconda init\n\nconda create --name cloudstor\n</pre><p style="text-align:start;"><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span>activate it and install cloudstor with</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p><pre>conda activate cloudstor\n\npip install numpy\n\npip install cloudstor\n</pre><p style="text-align:start;"><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span>Now add it to Jupyter notebook with the following commands</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p><pre>conda install -c anaconda ipykernel\n\npython -m ipykernel install --user --name=cloudstor\n</pre><p style="text-align:start;"><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span>Activate a Juptyer notebook and when selecting new file, instead of choosing Python3 choose the cloudstor kernel</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p><p style="text-align:start;"><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span>To see a list of files then access private files follow this example, password is the app password created above.</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p><pre>from cloudstor import cloudstor\n\nprivate_file = cloudstor(private=True, username="bollands.c@wehi.edu.au", password="*************")\n\nprivate_file.list('test/')\n\n['mydata.csv', 'test.csv', 'test_two.csv']\n\nwith private_file.open("test/test.csv") as f:\n\n    a = f.read()\n\nprint(a)\n</pre><p style="text-align:start;"><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span><span>To access a file that has been shared to you privately with a cloudstor link and password.</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p><pre>public_file = cloudstor(url="https://cloudstor.aarnet.edu.au/plus/s/rkXY4IcMEBsJScp", password='********)\n\nwith private_file.open("mydata1.csv") as f:\n\n    b = f.read()\n\nprint(b)</pre>
<p>Any issues please email the research computing team.</p>
