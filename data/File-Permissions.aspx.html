<h2><span class="fontColorThemeSecondary">The What and Why of File Permissions</span><br></h2><div><div>File permissions help you control who has access to your (or your labs) files and directories. With permissions you can allow everyone, specific groups/people, your own group, or just yourself access to your files. You can also control whether they can "read" "write" or "execute" your things.</div><div><br></div><h3><span class="fontColorThemeSecondary">Getting help</span></h3><div><div><span>While this page is intended to help you understand how to setup file permissions on Milton, getting it right is a little tricky. Setting inappropriate file permissions can lead to <strong>data loss</strong></span><span> or </span><span><strong>breaches of privacy</strong></span><span>. If you need help managing file permissions on data or lab spaces, please contact </span><a href="mailto:support@wehi.edu.au" data-cke-saved-href="mailto:support@wehi.edu.au" data-interception="on" title="mailto:support@wehi.edu.au"><span>helpdesk</span></a><span> or </span><a href="mailto:research.computing@wehi.edu.au" data-cke-saved-href="mailto:research.computing@wehi.edu.au" data-interception="on" title="mailto:research.computing@wehi.edu.au"><span>Research Computing Platform</span></a><span>.</span></div><div><br></div><h3><span class="fontColorThemeSecondary">Viewing and interpreting basic permissions</span></h3><div><div><span>Basic permissions of a file can be viewed using the </span><span>"ls -l"</span><span> command (or the </span><span>"ll"</span><span> command which is an </span><span><a href="/sites/rc2/SitePages/Setting-Up-Your-Environment.aspx#setting-aliases" data-cke-saved-href="https://wehieduau.sharepoint.com/sites/rc2/SitePages/Setting-Up-Your-Environment.aspx#setting-aliases" data-interception="on" title="https://wehieduau.sharepoint.com/sites/rc2/SitePages/Setting-Up-Your-Environment.aspx#setting-aliases">alias</a> of </span><span>"ls -l"</span><span>):</span></div><pre>$ ll\ntotal 0\n-rwxr-xr-x 1 yang.e allstaff    0 Oct 14 11:23 executable\n-rw-rw---- 1 yang.e allstaff    0 Oct 14 11:24 file2.txt\n-rw-r--r-- 1 yang.e allstaff    0 Oct 14 11:24 file.txt\ndrwxr-xr-x 2 yang.e allstaff 4096 Oct 14 11:24 folder</pre><div><span>The third column tells you who the "user" owner is, and the fourth colume tells you the "group" owner. In the above snippet, the user and group owners are </span><span>"yang.e"</span><span> and "</span><span>allstaff"</span><span>.</span></div><div><br></div><div><div><div><span>The first column describes the type of object, as well as its permissions. The first character specifies whether the object is a file or directory. A directory will have a </span><span>"d"</span><span>. A symbolic link will have </span><span>"l"</span><span>, and a file will have a </span><span>"-"</span><span>. The remaining columns describe the permissions for the "user", "group" and "other", each with a triplet of characters.</span></div><div><br></div><div><div class="canvasRteResponsiveTable"><div class="tableCenterAlign tableWrapper"><table style="width:770px;" class="bandedRowColumnTableStyleTheme cke_show_border"><tbody><tr><td role="columnheader">Object</td><td role="columnheader">type</td><td role="columnheader" style="width:153px;">"User" permissions</td><td role="columnheader" style="width:165px;">"Group" permissions</td><td role="columnheader" style="width:172px;">"Other" permissions</td></tr><tr><td role="rowheader"><strong>Column No.</strong></td><td>1</td><td style="width:153px;">2, 3, 4</td><td style="width:165px;">5, 6, 7</td><td style="width:172px;"><p>8, 9, 10</p></td></tr></tbody></table></div></div><div><div><br></div><div><span>These triplets describe, in order, the "read", "write", and "execute" permissions. The something the user/group/other is allowed to do would be accompanied by a character. Not having the permission would correspond to the character being replaced by a "</span><span>-</span><span>". For example,</span></div><pre><span>-rwxr-xr-x 1 yang.e allstaff    0 Oct 14 11:23 afile</span></pre><div><div><span>by column, means:</span></div><ol><li><span>-</span><span>: it is a file</span></li><li><span>r</span><span>: user (i.e., </span><span>"yang.e"</span><span>) has read permissions</span></li><li><span>w</span><span>: user has write permissions</span></li><li><span>x</span><span>: user has execute permissions</span></li><li><span>r</span><span>: group (i.e., </span><span>"allstaff"</span><span>) has read permissions</span></li><li><span>-</span><span>: group </span><span><strong>DOES NOT</strong></span><span> have write permissions</span></li><li><span>x</span><span>: group has execute permissions</span></li><li><span>r</span><span>: other (i.e. everyone else) has read permissions</span></li><li><span>-</span><span>: other </span><span><strong>DOES NOT</strong></span><span> have write permissions</span></li><li><span>x</span><span>: other has execute permissions</span></li></ol><div><span>So for this file, we know the user (yang.e) can read, write, and execute the file; whereas everyone else (including the group owner) can only read and execute it. </span></div><div><br></div><h4><span class="fontColorBlue">What do "read", "write", and "execute" mean?</span><br></h4><div class="canvasRteResponsiveTable"><div class="tableWrapper"><table style="width:980px;" class="bandedRowColumnTableStyleTheme cke_show_border"><tbody><tr><td role="rowheader"><br></td><td style="width:390px;">Files</td><td style="width:438px;">Directories<br></td></tr><tr><td role="rowheader"><strong>Read (r)</strong></td><td style="width:390px;"><span class="fontSizeMediumPlus">Contents can be read or opened e.g., with a text editor<br></span></td><td style="width:438px;"><span class="fontSizeMediumPlus">contents can be listed e.g., with `find` or `ls`<br></span></td></tr><tr><td role="rowheader"><strong>Write (w)</strong></td><td style="width:390px;"><span class="fontSizeMediumPlus">Contents and name can be modified or deleted</span></td><td style="width:438px;"><span class="fontSizeMediumPlus">name can be modified, and files can be created/deleted inside<br></span></td></tr><tr><td role="rowheader"><strong>Execute (x)</strong></td><td style="width:390px;"><span class="fontSizeMediumPlus">Can be run e.g., a script or binary</span></td><td style="width:438px;"><span class="fontSizeMediumPlus">Can be navigated to with the `cd` command<br></span></td></tr></tbody></table></div></div></div></div></div></div></div></div></div></div>
<h3><span class="fontColorThemeSecondary">Setting permissions with "chmod"</span><br></h3><div><div><span>Permissions can only be controlled by the user owner and the super user. This is done with the </span><span>`chmod`</span><span> command. </span><span>`chmod` can be used to either add, or subtract permissions. For example, given a text file, you can add the execute permission for everyone (user, group, and other):</span><div><pre>$ ll file.txt\n-rw-r--r-- 1 yang.e allstaff 0 Oct 14 11:24 file.txt\n\n$ chmod +x file.txt\n\n$ ll file.txt\n-rwxr-xr-x 1 yang.e allstaff 0 Oct 14 11:24 file.txt</pre><div><div><span>You can see that the </span><span>"x"</span><span> permission has been added for the user, group, and other fields. You can then "subtract" the execute permission for others only by</span><br></div><div><div><pre>$ chmod o-x file.txt\n\n$ ll file.txt\n-rwxr-xr-- 1 yang.e allstaff 0 Oct 14 11:24 file.txt</pre><div><div><span>and now the </span><span>"x"</span><span> attribute has disappeared only for the other field. Note that the </span><span>"o"</span><span> refers to other. User is referred to by </span><span>"u"</span><span> and group by </span><span>"g"</span><span>. You could then set both user and group to "read, write, and execute" by</span><br></div><span></span><div><pre>$ chmod ug+rwx file.txt\n\n$ ll file.txt\n-rwxrwxr-- 1 yang.e allstaff 0 Oct 14 11:24 file.txt</pre><h4><span class="fontColorBlue">"chmod" with octal permissions</span><br></h4><div><div><span>Octal permissions convert the </span><span>"rwx"</span><span> triplet to a single number by converting </span><span>"r = 4"</span><span>, "</span><span>w = 2"</span><span>, and </span><span>"x = 1"</span><span>. These individual numbers are summed to obtain a single number that summarises the permission for the user/group/other. For example, </span><span>`r-x`</span><span> would be translated into </span><span>"4 + 1 = 5"</span><span>, and "</span><span>-wx = 3"</span><span>. "</span><span>rwx"</span><span> would correspond to </span><span>"7"</span><span>. So, to set "</span><span>rwx (4 + 2 + 1)"</span><span> for the user, but only </span><span>"r-x (4 + 1)"</span><span> for the group and others, you can run the command</span><br></div><div><div><pre>chmod 755 script.sh</pre><div><div><span>Octal permissions may take a bit of mental math, but are useful as you can explicitly set the permissions instead of adding and subtracting permissions.</span><br></div><div><br></div><h4><span class="fontColorBlue">Changing permissions of the contents of a directory</span><br></h4><div><div><span>When </span><span>"chmod"</span><span> is used on a directory, the permissions are only changed for the directory, but not its contents. If you wish to update the permissions for a directory and all its contents, you can use the </span><span>"-R"</span><span> option (Recursive):</span><br></div><pre>chmod -R 755 directory</pre><div><span>which sets the </span><span>"rwx"</span><span> permission for the user and </span><span>"r-x"</span><span> permission for the group and other for directory and its contents.</span><br></div></div></div></div></div></div></div></div></div></div></div></div></div><pre><span></span></pre></div>
<h3><span class="fontColorThemePrimary">Fine-tuning permissions with Access Control Lists (ACLs)</span><br></h3><div><div><strong><span>NOTE</span></strong><span> ACLs are enabled on VAST, but not Stornext</span></div><br><div><span>You may have already noticed that the file permissions so far are somewhat limited: they can only control permissions for the user owner, the group, and everyone else (other). What if we want to give someone access to a directory, but they don't belong to the group? You could add them to the group, which might be undesirable as they could access everything else the group has access to; or you could open up the "other" permissions, but that would change it for everyone! Hence, ACLs are available to give specific people access, and it can also be used to set "default" permissions for directories. </span></div><br><h4><span class="fontColorBlue">Inspecting a file's ACLs</span></h4><div><span>ACLs are not visible from </span><span>"ls -l"</span><span> like normal file permissions are. However, you can tell whether a file has ACLs set on them by a </span><span>"+"</span><span> that exists at the end of the normal permissions Lists, e.g.:</span></div><pre>$ ls -l executable\n-rwxrwxr-x+ 1 yang.e allstaff 0 Oct 14 11:23 executable</pre><div><span>Once you've identified that ACLs are at-play, you can inspect them by</span></div><pre>$ getfacl executable\n# file: executable\n# owner: yang.e\n# group: allstaff\nuser::rwx\nuser:milton.m:rwx\ngroup::r-x\nmask::rwx\nother::r-x</pre><div><span>which shows the normal file permissions, but also that the user </span><span>`milton.m`</span><span> has been given </span><span>`rwx`</span><span> permission. </span></div><br><h4><span class="fontColorBlue">Setting ACLs</span></h4><div><span>ACLs are set with the </span><span>"setfacl"</span><span> command. The syntax is slightly different from chmod:</span></div><pre>setfacl -m &lt;entity&gt;:&lt;entity-name&gt;:&lt;permission&gt; file.txt</pre><div><span>where </span><span>"&lt;entity&gt;"</span><span> can be "</span><span>u"</span><span> AKA "</span><span>user"</span><span>; or "</span><span>g"</span><span> AKA "</span><span>group"</span><span>. The "</span><span>&lt;entity-name&gt;"</span><span> would be the user's or group's name, respectively; and the permissions would be in </span><span>"rwx"</span><span> format e.g., </span><span>"rw-"</span><span> for read and write, but not execute. "-m" is necessary to "modify" the ACL on the file.</span></div><br><div><span>Like </span><span>"chmod"</span><span>, you can pass </span><span>"-R"</span><span> to change the permissions of an entire directory's contents. Additionally, a capital </span><span>"X"</span><span> can be passed instead of the lowercase </span>"x"<span> to only apply the execute permission if the file being considered has the attribute already. For example, the below code shows what the effect of </span><span>"X"</span><span> when I'm giving a specific user access:</span></div><pre>$ getfacl folder/*\n# file: file1\n# owner: yang.e\n# group: allstaff\nuser::rw-\ngroup::r--\nother::r--\n\n# file: file2\n# owner: yang.e\n# group: allstaff\nuser::rwx\ngroup::r-x\nother::r-x\n\n$ setfacl -Rm u:iskander.j:rwX folder\n\n$ getfacl folder/*\n# file: file1\n# owner: yang.e\n# group: allstaff\nuser::rw-\nuser:iskander.j:rw-\ngroup::r--\nmask::rw-\nother::r--\n\n# file: file2\n# owner: yang.e\n# group: allstaff\nuser::rwx\nuser:iskander.j:rwx\ngroup::r-x\nmask::rwx\nother::r-x</pre><div><span>You can see that both files have had </span><span>"iskander.j"</span><span> given additional permissions, but they've only been given </span><span>"x"</span><span> permissions for </span><span>"file2"</span><span>, which had </span><span>"x"</span><span> set on it prior.</span><br></div><br><h4><span><span class="fontColorBlue">Default AC</span></span><span class="fontColorBlue">Ls</span><br></h4><div><span>For a directory, if you wish to ensure that new files created inside inherit the same permissions, specify a default permission. So in addition to setting the desired permission, repeat the same command but with </span><span>"d:"</span><span> i.e.,</span><br></div><pre>setfacl -Rm g:&lt;group&gt;:rwX &lt;directory&gt;\nsetfacl -Rm d:g:&lt;group&gt;:rwX &lt;directory&gt;</pre><div><span>The first command sets all the files inside the directory with rwx for </span><span>&lt;group&gt;</span><span>. Then, the second command adds the default permission, so all new files created in the directory are also accessible by </span><span>&lt;group&gt;</span><span>.</span><br></div><br></div>
<h3><span class="fontColorThemeSecondary">Guidance for Labs</span><br></h3><div><div><span>Setting up permissions too open, may lead to data loss and loss of privacy, which is more often an accident rather than intentional. It is important to set permissions appropriately so as not cause setbacks in your Research. We generally recommend starting from most restrictive (u:rwx, g:---, o:---) and loosening up permissions only if necessary, so as to mitigate the potential for data loss.</span></div><br><h4><span class="fontColorBlue">On Stornext lab spaces</span></h4><div><span><strong>Note</strong></span><span> that as Stornext does not have ACLs enabled, you're unable to use ACLs to control access to specific users. </span></div><br><div><span>Consequently, you can only work with normal file permissions. We generally recommend the "other" and "group" permissions are read and execute only, with write only being given to group if they are necessary. For sensitive files, ensure that "other" is not given any permissions. If you have sensitive data which requires fine-grained control (i.e., only specific people can access), please remember that </span><span><strong>ACLs are not enabled on stornext and permissions can only owner user, group, and other permissions can be set</strong></span></div><br><h4><span class="fontColorBlue">On VAST project spaces</span></h4><div><span><strong>Note</strong></span><span> If you have a VAST project space, you may not have a group assigned to it. Instead, you can control access via user ACLs.</span></div><br><div><span>The space owner can add users to the space with</span></div><pre>setfacl -m u:&lt;user&gt;:rwx</pre><div><span>which gives them to the top-level project directory and allows them to create content. We advise not providing every user write access to the contents to the space to mitigate the potential for data loss. Instead, only give write permissions to areas as necessary. Project members can give colleagues access to the files they create as needed.</span></div><br><h4><span class="fontColorBlue">Sharing VAST Scratch</span></h4><div><span>It is fairly common to wish to share files that exist on VAST Scratch with other researchers using Milton. We currently don't have a mechanism for opening </span><span><em>shared</em></span><span> VAST scratch spaces, but it is possible to avail your VAST scratch directory to another researcher using ACLs. </span></div><br><div><span>Let's say I (</span><span>yang.e</span><span>) wish to share a dataset in my VAST Scratch to my colleague, </span><span>milon.m</span><span>:</span></div><pre>/vast/scratch/users/yang.e/projectA/data-to-be-shared</pre><div><span>In this example, I only need </span><span>milton.m</span><span> to be able to </span><span><em>read</em></span><span> the data, but not modify it. More data may be added later, so I would also like </span><span>milton.m</span><span> to be able to read those too.</span></div><br><div><strong><span>Step 0. (Optional) disable permissions on everything</span></strong></div><br><div><span>If I need to ensure that </span><span>milton.m</span><span> cannot access anything besides </span><span>"data-to-be-shared"</span><span> e.g., I have sensitive data in my scratch, I will first want to ensure that that permission is explicitly set.</span><br></div><pre>setfacl -Rm u:milton.m:--- /vast/scratch/users/yang.e\nsetfacl -Rm d:u:milton.m:--- /vast/scratch/users/yang.e</pre><div><span>This ensures </span><span>milton.m</span><span> cannot access anything at all.</span></div><br><div><strong><span>Step 1. Enable navigation to folder</span></strong></div><br><div><span>I will first need to give </span><span>milton.m</span><span> the ability to navigate to </span><span>"data-to-be-shared"</span><span> by giving "execute" access to the parent directories:</span><br></div><pre>setfacl -m u:milton.m:x /vast/scratch/users/yang.e\nsetfacl -m u:milton.m:x /vast/scratch/users/yang.e/projectA</pre><div><span>This let's </span><span>milton.m</span><span> navigate to </span><span>"projectA"</span><span>, but does not let them run </span><span>"ls"</span><span> in any of the parent directories. However, </span><span><strong>note that milton.m may be able to execute/read/modify what is in "/vast/scratch/users/yang.e" and "projectA" if I did not follow step 0</strong></span><span>. </span><br></div><br><div><strong><span>Step 2. Enable necessary permissions on necessary directory/file</span></strong><br></div><br><div><span>Now that </span><span>`milton.m`</span><span> can navigate to the directory, I'll enable access to read the </span><span>"data-to-be-shared"</span><span> folder.</span><br></div><pre>setfacl -Rm u:milton.m:rX /vast/scratch/users/yang.e/projectA/data-to-be-shared\nsetfacl -Rm d:u:milton.m:rX /vast/scratch/users/yang.e/projectA/data-to-be-shared</pre><div><span>The first command allows </span><span>milton.m</span><span> to see what's inside the </span><span>"data-to-be-shared"</span><span> folder and subfolders, and the second command ensures the same permissions are set on files that get created.</span><br></div><br><div><span>milton.m</span><span> should now be able to read the files inside </span><span>"data-to-be-shared"</span><span> and new files that get created.</span><br></div></div>
