<h2><span class="fontColorThemeSecondary">Adding Conda or Python virtual environments to OnDemand Jupyter notebooks</span></h2><p>To use <span class="fontColorBlue"><em>conda</em></span> or Python virtual environments, you need to install <span class="fontColorBlue"><em>ipykernel</em></span> and register the kernel in each environment that you want to use in Jupyter.</p><h3><span class="fontColorThemeSecondary">Conda Example</span></h3><pre> conda env list\n # conda environments:\n #\n\nbase                  *  /stornext/System/data/apps/anaconda3/anaconda3-2019.03\nmy-new-env               /home/users/allstaff/iskander.j/myenvs/my-new-env\n</pre><p><strong>Then for each env:</strong></p><pre>conda activate base\nconda install ipykernel\npython -m ipykernel install --user --name base --display-name "Python (base)"\n</pre><pre>conda activate my-new-env\nconda install ipykernel\npython -m ipykernel install --user --name my-new-env --display-name "Python (my-new-env)"\n</pre><p>Then restart the Jupyter notebook and from <span class="fontColorBlue"><em>Kernel-&gt; Change kernel</em></span> you will find a list of all available kernels (conda envs).</p><h3><span class="fontColorThemeSecondary">Python Virtual Environment Example</span></h3><p>The above steps are similar for Python virtual environments</p><pre># activate your virtual environment\n. /path/to/mypyvenv/bin/activate\n\n# install ipykernel using pip\npip install ipykernel\n\n# install the new ipykernel\npython -m ipykernel install --user --name mypyenv --display-name "Python (mypyenv)"\n</pre><blockquote><p><span class="fontColorRed"><em><strong>Note:&nbsp;</strong></em></span>You must give each environment a unique name (<span class="fontColorBlue">--display-name</span>) ​​​​​​​that matches the conda environment names</p></blockquote>
<h2><span class="fontColorThemeSecondary">GPUs with Jupyter on On Demand</span></h2><p>GPUs can be used with Jupyter on On Demand by following the below instructions</p>
<p><br></p><p><br></p><p>1. Change the partition from "regular" to "gpuq"</p><p><br></p><p><br></p><p><br></p><p><br></p><p><br></p><p><br></p><p><br></p><p><br></p><p>2. Select your GPU type (currently A30 and P100 GPUs are available). At the moment, only 1 GPU is available per job.</p><p><br></p><p>Launch your Jupyter notebook.</p>
<h2><span class="fontColorThemeSecondary">Changing the working directory of Jupyter on Open OnDemand</span></h2><p>Currently, changing the working directory of the Jupyter server cannot be done after the server has been started from On Demand.&nbsp;By default, Jupyter Notebook is started in your $HOME directory, and then you can use the notebooks saved there.</p><p>To change this behaviour and start in another folder, use the following statement in Extra Jupyter arguments field in the form.</p><pre>--notebook-dir /path/to/change/to</pre><p>for example:</p><div><div tabindex="-1" data-cke-widget-wrapper="1" data-cke-filter="off" class="cke_widget_wrapper cke_widget_block cke_widget_inlineimage cke_widget_wrapper_webPartInRteInlineImage cke_widget_wrapper_webPartInRteClear cke_widget_wrapper_webPartInRteAlignCenter cke_widget_wrapper_webPartInRte" data-cke-display-name="div" data-cke-widget-id="1" role="region" aria-label="Inline image in RTE. Use Alt + F11 to go to toolbar. Use Alt + P to open the property pane."><div data-webpart-id="image" class="webPartInRte webPartInRteAlignCenter webPartInRteClear webPartInRteInlineImage cke_widget_element" data-cke-widget-data="%7B%22classes%22%3A%7B%22webPartInRteInlineImage%22%3A1%2C%22webPartInRteClear%22%3A1%2C%22webPartInRteAlignCenter%22%3A1%2C%22webPartInRte%22%3A1%7D%7D" data-cke-widget-upcasted="1" data-cke-widget-keep-attr="0" data-widget="inlineimage" data-instance-id="015c92b4-6678-4e2e-a0dc-dc1361a9056b" title=""></div></div><p>Which will change the Jupyter server working directory to /vast/scratch/users/iskander.j</p></div>
<h2><span class="fontColorThemeSecondary">July 6 2023 Jupyter Changes</span></h2><p>Previously, if you started Jupyter (including through OnDemand), it would use your Python 3.8 site-packages, namely packages installed into&nbsp;<em>~/.local/lib/python3.8</em>. If you ran <em>module load python3.8,&nbsp;</em>then any&nbsp;<em>pip install</em>&nbsp;commands would install packages to that location and would be accessible by Jupyter.</p><p>Since the change, Jupyter will no longer use your user site-packages by default. The advantages of this change are:</p><ul><li>Jupyter will be safe from changes in packages that you install. Previously it was possible to break Jupyter by installing certain packages into your home directory.</li><li>We can update the Jupyter Notebook version. Previously the Jupyter was frozen at an old version.</li><li>In the future we will be able to support configuring the Jupyter Notebook version. This will matter especially with the upcoming <a href="https://jupyter-notebook.readthedocs.io/en/latest/migrate_to_notebook7.html" data-cke-saved-href="https://jupyter-notebook.readthedocs.io/en/latest/migrate_to_notebook7.html" data-interception="on" title="https://jupyter-notebook.readthedocs.io/en/latest/migrate_to_notebook7.html">release of Jupyter 7.0</a></li></ul><p>You have two options to allow Jupyter to access your packages:</p><ul><li><span class="fontColorBlue"><strong>[Recommended]</strong></span> <strong><span class="fontColorBlue">Create and register a new Jupyter kernel</span></strong>. To do this,<ul style="margin-left:40px;"><li><em><span data-cke-bookmark="1" id="cke_bm_3878C" style="display:none;">&nbsp;</span><span data-cke-bookmark="1" id="cke_bm_3981C" style="display:none;">&nbsp;</span>​​​​​​​<span data-cke-bookmark="1" id="cke_bm_4382C" style="display:none;">&nbsp;</span>​​​​​​​Load a Python module <strong>or</strong></em>&nbsp;<em>activate a virtual environment</em>,&nbsp;<strong>or </strong><em>activate a conda environment </em>corresponding to&nbsp;where your packages are located</li><li>Run the&nbsp;<em>ipykernel&nbsp;</em>commands listed <strong><a href="/sites/rc2/SitePages/Jupyter-Open-OnDemand.aspx#adding-conda-or-python-virtual-environments-to-ondemand-jupyter-notebooks" data-cke-saved-href="https://wehieduau.sharepoint.com/sites/rc2/SitePages/Jupyter-Open-OnDemand.aspx#adding-conda-or-python-virtual-environments-to-ondemand-jupyter-notebooks" target="_blank" data-interception="off" title="https://wehieduau.sharepoint.com/sites/rc2/SitePages/Jupyter-Open-OnDemand.aspx#adding-conda-or-python-virtual-environments-to-ondemand-jupyter-notebooks">above</a></strong>.</li><li>Then, when you open a notebook, you will have to select the corresponding kernel, and your packages will be available.&nbsp;</li></ul></li></ul>
<ul><li><strong><span class="fontColorBlue">Check the "Include user python modules"&nbsp;checkbox</span></strong> when starting&nbsp;your Jupyter OnDemand session. Then, Jupyter will use your Python 3.11 site packages (<em>~/.local/lib/python3.11)</em>. Note that this is different from the old default, which used Python 3.8. Therefore, if you do this, you will have to reinstall the packages&nbsp;you need for Jupyter after running&nbsp;<em>module load python3.11. </em>​​​​​​​</li></ul><p style="margin-left:40px;"><em>​​​​​​​​​​​​​​</em>Also note that,&nbsp;if you check the "user python modules" box, it is not recommended that you change kernels as shown above, because then Jupyter might try to load&nbsp;packages from a conflicting Python version.</p>
