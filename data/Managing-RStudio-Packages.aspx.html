<h2>R Packages on Milton<br></h2><p>By default, when you install R packages either by R on the command-line, or on the <a href="http://rstudio.hpc.wehi.edu.au" data-cke-saved-href="http://rstudio.hpc.wehi.edu.au" data-interception="on" title="http://rstudio.hpc.wehi.edu.au">RStudio server</a>, packages will be installed into your home directory (inside an <em>R</em> folder). This can be inconvenient as the home directory is very limited in space (each user is given 20GB). Consequently, this page is concerned with changing where R/Rstudio looks for and installs packages<br></p><h3><span class="fontColorThemeSecondary">On Rstudio</span><br></h3><p><span class="fontColorThemeSecondary"></span>The Rstudio server used at WEHI looks for a file named <em>.r_bashrc</em> in your home directory on Milton (note the "." prefixing the filename). RStudio uses this file to setup its environment. To use this file to change where packages are installed, as well as changing the temporary directory, create the file and add the following code:<br></p><pre>export R_LIBS=/path/to/where/to/install/R/Packages<br>export TMPDIR=/vast/scratch/users/&lt;your-username&gt;/tmp<br></pre><p>And newly started sessions will use these directories to install packages and write temporary files to, respectively.<br></p><p>If you are having trouble installing software, you are always welcome to seek help and advice from Research Computing via a <a href="mailto:helpdesk@wehi.edu.au" data-cke-saved-href="mailto:helpdesk@wehi.edu.au" target="_blank" data-interception="off" title="mailto:helpdesk@wehi.edu.au">Helpdesk</a> ticket.<br></p><h3><span class="fontColorThemeSecondary">Downloading source code</span></h3><p>You may need to download source code if the software is written in a compiled language, or you need a newer version than the one currently available through your language's distribution mechanism. The overwhelming majority of scientific source code is Open Source and available on GitHub.</p><p>By convention, authors make releases of code, with an associated version number, that they believe to be of acceptable quality. If possible, use a release. These are available on the release tab of the software GitHub page. Releases are usually available as an archive. Download, uncompress and follow the build/install instructions.</p><p>Alternatively, you can clone the repository if:</p><ul><li>you specifically want to work with the latest version of the software</li><li>you want to modify the software (you can then optionally checkout out a stable release).</li></ul><p><br>To clone a repository, select the big green "Clone or Download" button, copy the URL, then</p><pre>git clone &lt;repository URL&gt;\n</pre><p>While GitHub is the most popular hosted repository service there are others and the procedures will be similar.</p><h3><span class="fontColorThemeSecondary">Compiled software</span></h3><p>Languages such as C, C++, and Fortran require a one-time translation from source code into a binary format that the CPU can execute directly (machine code). Compiled software is often built with <span class="fontColorBlue"><em>make</em></span> or <span class="fontColorBlue"><em>CMake</em></span>. Often this command needs no arguments as it reads a file called <span class="fontColorBlue"><em>Makefile</em></span> by default. <span class="fontColorBlue"><em>Makefile</em></span> describes how the software should be built.</p><p>These examples are not meant to suggest that researchers need to build and maintain core tools. Rather, they demonstrate that even sophisticated software is often very easy to build yourself.</p>
<h3><span class="fontColorThemeSecondary">Examples of simple builds</span></h3><h4><strong><span class="fontColorBlue">bwa</span></strong></h4><pre>git clone https://github.com/lh3/bwa.git\ncd bwa\nmake\n</pre><p>The <em><span class="fontColorBlue">bwa</span></em> program is built in the current directory.</p><h4><strong><span class="fontColorBlue">bowtie2</span></strong></h4><pre>git clone https://github.com/BenLangmead/bowtie2.git\ncd bowtie2\nmake\n</pre><p>The <em><span class="fontColorBlue">bowtie2</span></em> program is built in the current directory.</p><p>More complex software may need to know more about the environment where it is being built. These tools typically come with a <span class="fontColorBlue"><em>configure</em></span> script that attempts to adapt the build to the local environment. The <span class="fontColorBlue"><em>configure</em></span> script will take options to tell it where dependencies are and where software should be installed.</p><pre>./configure --help\n</pre>
<h3><span class="fontColorThemeSecondary">Examples of <span class="fontColorBlue"><em>configure</em></span> based builds</span></h3><h4><strong><span class="fontColorBlue">Python</span></strong></h4><p>In this example:</p><ol><li>Clone the CPython repository</li><li>Checkout a specific release</li><li>Run <span class="fontColorBlue"><em>configure</em></span> with an option indicating where the software is to be installed</li><li>Build using <span class="fontColorBlue"><em>make -j4</em></span> This tells make to run up to 4 tasks concurrently</li><li>Install the software in your home directory</li><li>Check that it runs</li></ol><pre>git clone https://github.com/python/cpython.git\ncd cpython/\ngit checkout v3.8.0b1\n./configure --prefix=$HOME/mypython\nmake -j 4\nmake install\nexport PATH=$HOME/mypython/bin:$PATH\n$ python3\nPython 3.8.0b1 (v3.8.0b1:3b5deb0, Jun  6 2019, 16:38:48) \n[GCC 4.8.5 20150623 (Red Hat 4.8.5-11)] on linux\nType "help", "copyright", "credits" or "license" for more information.\n&gt;&gt;&gt; \n</pre><h4><strong><span class="fontColorBlue">samtools</span></strong></h4><p>This example is slightly more complicated because samtools has a dependency on htslib.</p><ol><li>Clone the samtools repository</li><li>Clone the htslib repository</li><li>Checkout a specific release</li><li>Run some scripts that build the configure script</li><li>Run <span class="fontColorBlue"><em>configure</em></span> with an option indicating where the software is to be installed</li><li>Build using <span class="fontColorBlue"><em>make -j4</em></span>. This tells make to run up to 4 tasks concurrently</li><li>Install the software in your home directory</li><li>Check that it runs</li></ol><pre>git clone https://github.com/samtools/samtools.git\ngit clone https://github.com/samtools/htslib.git\ncd htslib\ngit checkout 1.9\ncd ../samtools\ngit checkout 1.9\nautoheader\nautoconf -Wno-syntax\n./configure --prefix=$HOME/mysam\nmake\nmake install\n$HOME/mysam/bin/samtools</pre>
<h3><span class="fontColorThemeSecondary">Compilers</span></h3><p>Some software may require or recommend being built with specific compiler versions. ITS provide a number of versions of <span class="fontColorBlue"><em>gcc</em></span>, the <em>de facto</em> standard compiler for Linux. These are available through the module system. The <span class="fontColorBlue"><em>module av gcc</em></span> will list available compiler versions.</p><h2>Installing Python software</h2><p>There are two methods for installing Python software, <span class="fontColorBlue"><em>anaconda</em></span> and <span class="fontColorBlue"><em>pip</em></span>. The latter can install software in the user's home area or into a Python virtual environment. WEHI provides a number of stable versions of Python via the module system, use the <span class="fontColorBlue"><em>module av python</em></span> to list available versions. Use the latest stable version if possible, however, you may be constrained by other dependencies.</p>
<h3><span class="fontColorThemeSecondary">Installing in the default home area</span></h3><pre>module load python/&lt;version&gt;\npip install --user &lt;package&gt;\n</pre><p>This will install the software in the <span class="fontColorBlue"><em>~/.local</em></span> directory in your home area. These modules are then automatically available to import without any additional manipulation of your <em><span class="fontColorBlue">PYTHONPATH</span></em>.</p><p>Some Python software creates convenience scripts for launching the software. These will be available in <span class="fontColorBlue"><em>~/.local/bin</em></span> and you may need to add this directory to your <span class="fontColorBlue"><em>PATH</em></span> environment variable.</p>
<h3><span class="fontColorThemeSecondary">Installing directly from GitHub</span></h3><p><span class="fontColorBlue"><em>pip</em></span> can install software directly from GitHub.</p><pre>pip install git+https://github.com/&lt;repo&gt;\n</pre><p><br></p>
<h3><span class="fontColorThemeSecondary">Virtual environments</span></h3><p>The abundance of software written in Python means that Python environments can be brittle. The Python community has developed a tool called <span class="fontColorBlue"><em>virtualenv</em></span> which can quickly create an isolated Python environment. These environments can be created on a per-project basis with just the required software for that project. If something goes wrong, that environment can be easily destroyed and recreated.</p><p>In the next example, the Unix prompts are included to demonstrate the prompt changes when the virtual environment changes. When the virtual environment is no longer needed it can simply be removed. Note that when using the environment in scripts, such as batch jobs, it will either need to be activated or the full path to the environment interpreter needs to be used.</p><p><span class="fontColorRed"><strong>Warning:</strong></span> Virtual environments can take several GB of space if there is a lot of software installed in them. They may not fit in your home area. It is better to create and run them in your project area or your HPCScratch area as shown in the next example.</p><pre>[thomas.e@vc7-shared ~]$ cd /stornext/HPCScratch/home/thomas.e/\n[thomas.e@vc7-shared thomas.e]$ module load python/3.7.0\n[thomas.e@vc7-shared thomas.e]$ virtualenv myvenv\nUsing base prefix '/stornext/System/data/apps/python/python-3.7.0'\nNew python executable in /stornext/HPCScratch/home/thomas.e/myvenv/bin/python3.7\nAlso creating executable in /stornext/HPCScratch/home/thomas.e/myvenv/bin/python\nInstalling setuptools, pip, wheel...\ndone.\n[thomas.e@vc7-shared thomas.e]$ . myvenv/bin/activate\n(myvenv) [thomas.e@vc7-shared thomas.e]$ pip install &lt;this&gt; &lt;that&gt; &lt;other&gt;\n(myvenv) [thomas.e@vc7-shared thomas.e]$ which python\n/stornext/HPCScratch/home/thomas.e/myvenv/bin/python\n(myvenv) [thomas.e@vc7-shared thomas.e]$ deactivate \n[thomas.e@vc7-shared thomas.e]$ which python\n/stornext/System/data/apps/python/python-3.7.0/bin/python\n</pre><p>The bash prompt will change to indicate that the virtual environment is active.</p><p>To delete the virtual environment</p><pre>[thomas.e@vc7-shared thomas.e]$ rm -rf myvenv/</pre>
<p><span class="fontColorBlue"><em>Create a virtual environment for a project you are working on in the project directory.</em></span></p><p><span class="fontColorBlue"><em>If you need to come back at a later date to review the results the (Python) software environment will still be there.</em></span></p>
<h3>​​​<span class="fontColorThemeSecondary">Anaconda</span></h3><p>Anaconda is a system for distributing both Python and non-Python software. It provides a sophisticated tool for managing virtual environments beyond the virtual environments described above. The WEHI anaconda environments have a lot of tools already installed and the ability to install software in the user's Python environments. Anaconda provides all the standard Python tools, such as <span class="fontColorBlue"><em>pip</em></span>, as well as the <span class="fontColorBlue"><em>conda</em></span> command, a powerful tool for managing the virtual environment and installing additional packages, including some that are not available through <span class="fontColorBlue"><em>pip</em></span>. In addition, <span class="fontColorBlue"><em>conda</em></span> can install not just Python software but compiled tools, for example, standard bioinformatics tools such as samtools, bwa, etc. These environments can be associated with projects and left <em>frozen</em> alongside the data and results.</p><p>Anaconda is available at WEHI through the module system. To see which versions are available use <em><span class="fontColorBlue">module av anaconda</span></em>. There are two classes of modules, anaconda2 and anaconda3 and within them, there are several versions. The main difference is the version of Python that they bring with them. There are also some differences in behaviour between recent versions of anaconda. This guide refers to the default anaconda3 module.</p><p>Be aware, that only one version of anaconda can be loaded at a time and this will unload any Python or anaconda modules that you may have loaded.</p><h4><strong><span class="fontColorBlue">To use Anaconda</span></strong></h4><pre>module load anaconda3\n</pre><p><strong>When first using conda:</strong></p><pre>conda init\n</pre><p><strong>To list the packages that are already loaded:</strong></p><pre>$ conda list\n# packages in environment at /stornext/System/data/apps/anaconda3/anaconda3-2019.03:\n#\n# Name                    Version                   Build  Channel\n_ipyw_jlab_nb_ext_conf    0.1.0                    py37_0  \nalabaster                 0.7.12                   py37_0  \nanaconda                  2019.03                  py37_0  \n[etc]\n</pre><p><span class="fontColorRed"><strong>Note:</strong></span> <span class="fontColorBlue"><em>conda</em></span> is very slow.</p><p>The command lists the package, tool version, Python version, and channel. A channel in Anaconda is a special package repository, for example, Bioconda specialises in tools for biology and bioinformatics.</p><p><strong>To create an anaconda virtual environment:</strong></p><pre>conda create -n &lt;name&gt;\n</pre><p>For example:</p><pre>[thomas.e@vc7-shared ~]$ conda create -n test\nCollecting package metadata: done\nSolving environment: done\n\n## Package Plan ##\n\n  environment location: /home/users/allstaff/thomas.e/.conda/envs/test\n\n\n\nProceed ([y]/n)? y\n\nPreparing transaction: done\nVerifying transaction: done\nExecuting transaction: done\n#\n# To activate this environment, use:\n# &gt; conda activate test\n#\n# To deactivate an active environment, use:\n# &gt; conda deactivate\n#\n</pre><p><strong>To use the environment:</strong></p><pre>[thomas.e@vc7-shared ~]$ conda activate test\n(test) [thomas.e@vc7-shared ~]$ \n</pre><p><span class="fontColorRed"><strong>Note: </strong></span>that the bash prompt changes to indicate that the virtual environment is active.</p><p><strong>To leave the virtual environment:</strong></p><pre>(test) [thomas.e@vc7-shared ~]$ conda deactivate\n[thomas.e@vc7-shared ~]$ \n</pre><p><strong>As an example of installing some software:</strong></p><pre>$ conda install -c Bioconda samtools\n</pre><p>In this case, the command is specifying a channel with the <em><span class="fontColorBlue">-c</span></em> option. The command will provide detail about the dependencies that also need to be installed, their channels, and then prompt as to whether to proceed.</p><pre>$ conda list \n# packages in environment at /home/users/allstaff/thomas.e/.conda/envs/test:\n#\n# Name                    Version                   Build  Channel\nbzip2                     1.0.6                h14c3975_5  \nca-certificates           2019.5.15                     0  \ncurl                      7.64.1               hbc83047_0  \nkrb5                      1.16.1               h173b8e3_7  \nlibcurl                   7.64.1               h20c2e04_0  \nlibdeflate                1.0                  h14c3975_1    Bioconda\nlibedit                   3.1.20181209         hc058e9b_0  \nlibgcc-ng                 9.1.0                hdf63c60_0  \nlibssh2                   1.8.2                h1ba5d50_0  \nlibstdcxx-ng              9.1.0                hdf63c60_0  \nncurses                   6.1                  he6710b0_1  \nopenssl                   1.1.1c               h7b6447c_1  \nsamtools                  1.9                 h8571acd_11    Bioconda\ntk                        8.6.8                hbc83047_0  \nxz                        5.2.4                h14c3975_4  \nzlib                      1.2.11               h7b6447c_3  \n$ which samtools\n~/.conda/envs/test/bin/samtools\n</pre><p><span class="fontColorBlue"><em>conda</em></span> will understand software installed through <span class="fontColorBlue"><em>pip</em></span> and <span class="fontColorBlue"><em>conda</em></span> but <span class="fontColorBlue"><em>pip</em></span> will be unaware of anything installed by <span class="fontColorBlue"><em>conda</em></span>.</p><p>List your <span class="fontColorBlue"><em>conda</em></span> environments:</p><pre>(test) [thomas.e@vc7-shared ~]$ conda list env\n# packages in environment at /home/thomas.e/.conda/envs/test:\n#\n# Name                    Version                   Build  Channel\n(test) [thomas.e@vc7-shared ~]$ conda env list\n# conda environments:\n#\ntest                  *  /home/users/allstaff/thomas.e/.conda/envs/test\nbase                     /stornext/System/data/apps/anaconda3/anaconda3-2019.03\n\n</pre><p>For more on Anaconda, go to the <a href="https://conda.io/projects/conda/en/latest/user-guide/index.html" data-cke-saved-href="https://conda.io/projects/conda/en/latest/user-guide/index.html" target="_blank" data-interception="off" title="https://conda.io/projects/conda/en/latest/user-guide/index.html">Anaconda User Guide​​​​​​​ </a></p>
<h2>Installing R packages</h2><p>Managing software environments in R can be difficult because they depend on the minor versions or R, e.g. from 3.5.0 to 3.6.0. R versions have the following meaning: <span class="fontSizeMediumPlus"><span class="fontColorRed"><span class="highlightColorGrey">&lt;major version&gt;.&lt;minor version&gt;.&lt;patch level&gt;</span></span></span></p><p>WEHI provides stable releases of R through the module system.</p><pre>module av R\n</pre><p>When you install your first package, R will prompt you to create a personal library. For example:</p><pre>$ <span class="fontColorRed">module load R</span>\n$ <span class="fontColorRed">R</span>\n\nR version 3.5.2 (2018-12-20) -- "Eggshell Igloo"\nCopyright (C) 2018 The R Foundation for Statistical Computing\nPlatform: x86_64-pc-linux-gnu (64-bit)\n\nR is free software and comes with ABSOLUTELY NO WARRANTY.\nYou are welcome to redistribute it under certain conditions.\nType 'license()' or 'licence()' for distribution details.\n\n  Natural language support but running in an English locale\n\nR is a collaborative project with many contributors.\nType 'contributors()' for more information and\n'citation()' on how to cite R or R packages in publications.\n\nType 'demo()' for some demos, 'help()' for on-line help, or\n'help.start()' for an HTML browser interface to help.\nType 'q()' to quit R.\n&gt; install.packages('zip')\nWarning in install.packages(zip) :\n  'lib = "/stornext/System/data/apps/R/R-3.5.2/lib64/R/library"' is not writable\nWould you like to use a personal library instead? (yes/No/cancel) yes\nWould you like to create a personal library\n‘~/R/x86_64-pc-linux-gnu-library/3.5’\nto install packages into? (yes/No/cancel) yesInstalling package into ‘/stornext/HPCScratch/home/thomas.e/R/x86_64-pc-linux-gnu-library/3.5’\n (as ‘lib’ is unspecified)\n --- Please select a CRAN mirror for use in this session ---\n Secure CRAN mirrors \n \n  1: 0-Cloud [https]                   2: Algeria [https]                \n  3: Australia (Canberra) [https]      4: Australia (Melbourne 1) [https]\n  [cut]\n \n Selection: 1\ntrying URL 'https://cloud.r-project.org/src/contrib/zip_2.0.2.tar.gz'\nContent type 'application/x-gzip' length 95839 bytes (93 KB)\n==================================================\ndownloaded 93 KB\n\n* installing *source* package ‘zip’ ...\n** package ‘zip’ successfully unpacked and MD5 sums checked\n** libs\n/stornext/System/data/apps/gcc/gcc-7.3.0/bin/gcc -g -O2  miniz.c zip.c tools/cmdzip.c -o tools/cmdzip\n/stornext/System/data/apps/gcc/gcc-7.3.0/bin/gcc -g -O2  miniz.c zip.c tools/cmdunzip.c -o tools/cmdunzip\n/stornext/System/data/apps/gcc/gcc-7.3.0/bin/gcc -I"/stornext/System/data/apps/R/R-3.5.2/lib64/R/include" -DNDEBUG   -I/usr/local/include   -fpic  -g -O2  -c init.c -o init.o\n/stornext/System/data/apps/gcc/gcc-7.3.0/bin/gcc -I"/stornext/System/data/apps/R/R-3.5.2/lib64/R/include" -DNDEBUG   -I/usr/local/include   -fpic  -g -O2  -c miniz.c -o miniz.o\n/stornext/System/data/apps/gcc/gcc-7.3.0/bin/gcc -I"/stornext/System/data/apps/R/R-3.5.2/lib64/R/include" -DNDEBUG   -I/usr/local/include   -fpic  -g -O2  -c rzip.c -o rzip.o\n/stornext/System/data/apps/gcc/gcc-7.3.0/bin/gcc -I"/stornext/System/data/apps/R/R-3.5.2/lib64/R/include" -DNDEBUG   -I/usr/local/include   -fpic  -g -O2  -c zip.c -o zip.o\n/stornext/System/data/apps/gcc/gcc-7.3.0/bin/gcc -shared -L/stornext/System/data/apps/R/R-3.5.2/lib64/R/lib -L/usr/local/lib64 -o zip.so init.o miniz.o rzip.o zip.o -L/stornext/System/data/apps/R/R-3.5.2/lib64/R/lib -lR\ninstalling via 'install.libs.R' to /stornext/HPCScratch/home/thomas.e/R/x86_64-pc-linux-gnu-library/3.5/zip\n** R\n** inst\n** byte-compile and prepare package for lazy loading\n** help\n*** installing help indices\n** building package indices\n** testing if installed package can be loaded\n* DONE (zip)\n\nThe downloaded source packages are in\n\t‘/tmp/RtmpeFaJF2/downloaded_packages’\n\n&gt; library(zip)\n\nAttaching package: ‘zip’\n\nThe following objects are masked from ‘package:utils’:\n\n    unzip, zip\n&gt;\n</pre><p>Not all packages are available in all mirrors. Preferably choose a Melbourne mirror but try a different mirror if the install fails.</p><h3><span class="fontColorThemeSecondary">Bioconductor</span></h3><p>An important source of biology software is <a data-interception="off" title="https://www.bioconductor.org/" href="https://www.bioconductor.org/" data-cke-saved-href="https://www.bioconductor.org/" target="_blank">Bioconductor</a>. This software is managed by a different tool. At WEHI this tool is already installed. Nevertheless, read the <a data-interception="off" title="https://www.bioconductor.org/install/" href="https://www.bioconductor.org/install/" data-cke-saved-href="https://www.bioconductor.org/install/" target="_blank">Bioconductor installation page</a> if you are interested.</p><p><strong>To install a Bioconductor package:</strong></p><pre>&gt; BiocManager::install("AnnotationDbi")\n</pre><h3><br><span class="fontColorThemeSecondary">R dev tools</span></h3><p>Dev tools allow the installation of R software directly from GitHub. It requires installation of the devtools library:</p><pre>&gt; install.packages('devtools')\n</pre><p>To install a package from a git repo:</p><pre>&gt; devtools::install_github("hadley/tidyverse")\n</pre><h3><br><span class="fontColorThemeSecondary">Installing directly from a source archive</span></h3><p>Occasionally&nbsp;software is distributed directly as source code. To install in this way, use the shell command:</p><pre>$ R CMD INSTALL &lt;archive file&gt;\n</pre><p>Be aware this may not manage dependencies well.</p><p>An alternative method is:</p><pre>&gt; install.packages('/path/to/archive')\n</pre><p>This may handle dependencies better.</p><h3><span class="fontColorThemeSecondary">Troubleshooting</span></h3><p>Because the R environment evolves rapidly, packages can get off sync. If a particular package is failing, first try reinstalling it. In extreme cases, delete your personal library directory from the command line and reinstall all your packages.</p>
