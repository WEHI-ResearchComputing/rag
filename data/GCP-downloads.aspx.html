<h2>Downloading from Google Cloud Platform</h2><p><a data-cke-saved-href="https://cloud.google.com/gcp" href="https://cloud.google.com/gcp" target="_blank" title="https://cloud.google.com/gcp" data-interception="off">Google Cloud Platform</a> (GPC) is one of the major commercial clouds. Because of the partnership with the Broad Institute and other major institutes, a lot of interesting research data are stored there. This guide describes how to efficiently download large (hundreds of objects or more) datasets. Large downloads need careful handling because:<br><br></p><ol><li>The more files there are the more likely the download will fail partway through.</li><li>Depending on the origin of the data, you may be paying for data transfer.</li></ol><p>Together, these mean that the download process should be able able to restart efficiently after failure to avoid redownloading lots of data.</p><h3><span class="fontColorThemeSecondary">Choose a download location</span></h3><p>If the data can be redownloaded, place them on VAST Scratch. You can request access by sending an email to<a href="mailto:support@wehi.edu.au" data-cke-saved-href="mailto:support@wehi.edu.au" target="_blank" data-interception="off" title="mailto:support@wehi.edu.au"> support@wehi.edu.au</a>. Otherwise, place them in your backed-up lab area.</p><p>If you are unsure, or if there is &gt;1TB of data, please contact Research Computing for advice.</p><h3><span class="fontColorThemeSecondary">Download script</span></h3><p>There is a Python template script here: <a data-cke-saved-href="https://github.com/WEHI-ResearchComputing/milton-contrib/blob/master/download-scripts/dl.py" href="https://github.com/WEHI-ResearchComputing/milton-contrib/blob/master/download-scripts/dl.py" target="_blank" title="https://github.com/WEHI-ResearchComputing/milton-contrib/blob/master/download-scripts/dl.py" data-interception="off">github.com/WEHI-ResearchComputing/milton-contrib/blob/master/download-scripts/dl.py</a></p><p>Update the constants, near the top, to match your requirements. The script works as follows:<br><br></p><ol><li>A list of objects to download is provided in the <em><span class="fontColorBlue">INPUT_LIST</span></em> file, one line per object.</li><li>For each object, the script checks if it is already downloaded in the <em><span class="fontColorBlue">FINAL_DIR</span></em>. If it is then it is skipped.</li><li>If the file needs to be downloaded, it is downloaded to the <em><span class="fontColorBlue">TEMP_DIR</span></em>.</li><li>After downloading, the file is checked by using <span class="fontColorRed"><span class="highlightColorGrey">tar -t</span></span>.</li><li>If the file passes testing, it is moved to the <em><span class="fontColorBlue">FINAL_DIR</span></em>.</li></ol><p>The script can perform several downloads in parallel.</p><p><span class="fontColorRed"><strong>Note:</strong></span> If the files you are downloading are not <strong>.tar</strong> files, update the <em><span class="fontColorBlue">check</span></em> function, near line 45, with an appropriate check for your file type.</p><h3><span class="fontColorThemeSecondary">Submitting to the batch system</span></h3><p>The download should run in the batch system. Update the following template to match your requirements.</p><pre>#!/bin/bash\n\n#SBATCH --job-name=gcp_download\n#SBATCH --time=2-00:00:00\n#SBATCH --cpus-per-task=10\n#SBATCH --mem=8G\n\ncd &lt;download directory&gt;\nmodule load google-cloud-sdk\n\npython3 dl.py\n</pre><p>After submitting, monitor the output directory to check that downloaded files are accumulating there and monitor the job output for errors.</p><h3><span class="fontColorThemeSecondary">If you need help</span></h3><p>If you need help or if the scripts do not meet your requirements please contact <a data-cke-saved-href="mailto:research.computing@wehi.edu.au" href="mailto:research.computing@wehi.edu.au" target="_blank" title="mailto:research.computing@wehi.edu.au" data-interception="off">research.computing@wehi.edu.au</a> or <a href="mailto:support@wehi.edu.au" data-cke-saved-href="mailto:support@wehi.edu.au" target="_blank" data-interception="off" title="mailto:support@wehi.edu.au">support@wehi.edu.au</a>.</p>
