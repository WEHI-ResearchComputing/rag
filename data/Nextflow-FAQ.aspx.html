<p>This page is dedicated to answering frequently asked questions regarding Nextflow</p>
<h3>Nextflow isn't finding files in my home directory (when using singularity containers)!</h3><p>This is due to a change in the 23.10.0 release of Nextflow whereby home directories are no longer mounted into containers by default. Unfortunately, this wasn't documented in their release notes. To enable mounting of your home directory into your pipeline's singularity containers, run:</p><pre>export NXF_SINGULARITY_HOME_MOUNT=true</pre><p>Which you may want to put into your ~/.bashrc if you rely on files in your home directory regularly, e.g., config files.</p>
<h3>My Nextflow pipeline is failing on Milton during the container pull stage, but the error message doesn't say why!</h3><p>if your pipeline fails and your errors have something like:</p><pre>Caused by:<br><span class="highlightColorYellow"> Failed to pull singularity image</span><br> command: singularity pull  --name ghcr.io-wehi-researchcomputing-haemosphere-latest.img.pulling.1710721200833 docker://ghcr.io/wehi-researchcomputing/haemosphere:latest &gt; /dev/null<br><span class="highlightColorYellow"> status : 143</span><br> message:<br>   INFO:    Converting OCI blobs to SIF format<br>   INFO:    Starting build...<br>   Getting image source signatures<br>   Copying blob sha256:9d19ee268e0d7bcf6716e6658ee1b0384a71d6f2f9aa1ae2085610cf7c7b316f<br><br> ... skipped output ...<br><br>   2024/03/18 11:31:02  info unpack layer: sha256:e5a50e1173436b4242b02cff1322507cbd5cce18c675ea94dc11ccb6bb8e3ef0<br><br><br><br>-- Check '.nextflow.log' file for details</pre><p>This could be because of the Nextflow's timeout parameters when pulling containers. This can happen with large containers (in terms of many files) built on VAST.</p><p aria-hidden="true">&nbsp;</p><p>To resolve this, update your personal Nextflow config file's “singularity” scope with the pullTimeout config:</p><pre>$ vi ~/.nextflow/config<br><br>singularity {<br>   enabled = true<br>   autoMounts = true<br>   runOptions = '-B /vast -B /stornext -B $HOME'<br><span class="highlightColorYellow">   pullTimeout = "1h"</span><br>}</pre><p>Above shows updating the timeout to 1 hour, which should be enough for most cases, but be prepared to increase it.</p>
<h3>How do I change Singularity version or unload miniconda module dependencies?</h3><p>The Nextflow module on Milton is setup such that the Singularity, Miniconda, and Micromamba modules are loaded as dependencies, so as to make the running of pipelines a little more convenient. However, in some cases, this can cause issues e.g., some container require a newer version of Singularity/Apptainer, or a conflict with Miniconda and Python modules on the system. However, by default, unloading a dependency module will also unload the dependant module. For example:</p><p aria-hidden="true">&nbsp;</p><pre># load the Nextflow module<br>$ module load nextflow<br><br>... some warnings ...<br><br>Loading nextflow/23.10.0<br> Loading requirement: singularity/3.7.4 miniconda3/latest micromamba/latest<br><br># unload miniconda<br>$ module unload miniconda3<br>Unloading miniconda3/latest<br><span class="highlightColorYellow"> Unloading dependent: nextflow/23.10.0</span><br> Unloading useless requirement: micromamba/latest singularity/3.7.4</pre><p>To get around this, you can unload the relevant module by:</p><pre>$ module unload --no-auto -f singularity<br>Unloading singularity/3.7.4<br> WARNING: Dependent nextflow/23.10.0 is loaded<br><br># check that Nextflow is indeed still loaded<br>$ module list<br>Currently Loaded Modulefiles:<br>1) miniconda3/latest   2) micromamba/latest   3) nextflow/23.10.0</pre><p>and if needed, you can replace the module with an alternative:</p><pre>$ module load apptainer/1.2.3</pre>
