<h2>Job submission scripts</h2><p>This page provides more details about creating job submission scripts.</p><h3><span class="fontColorThemeSecondary">Job submission: script structure</span></h3><p>In general, a job submission script can be split into three different parts:</p><h4><span class="fontColorBlue">Part 1</span></h4><p>It must begin on the first line with the interpreter (or the system won’t recognise the script):<br><strong><em><span class="fontColorBlue">#!/bin/bash</span></em></strong><br></p><p>See the <a href="/sites/rc2/SitePages/SLURM-advanced-job-scripts.aspx#using-other-interpreters-besides-bash" data-cke-saved-href="https://wehieduau.sharepoint.com/sites/rc2/SitePages/SLURM-advanced-job-scripts.aspx#using-other-interpreters-besides-bash" data-interception="on" title="https://wehieduau.sharepoint.com/sites/rc2/SitePages/SLURM-advanced-job-scripts.aspx#using-other-interpreters-besides-bash">Using other interpreters section</a> below to learn how to submit R and Python scripts directly<br></p><h4><span class="fontColorBlue">Part 2</span></h4><p>An optional part of the script specifies the resources and other job parameters. Each resource request should begin with the directive <em><span class="fontColorBlue">#SBATCH</span></em> followed by the request detail, eg. <em><span class="fontColorBlue">#SBATCH --time=01:08:10 </span></em>to request 1hr 8mins and 10 seconds. Parameters can also be specified on the command line when submitting the job.<br><br>Resources can be specified as directives. Lines starting with <em><span class="fontColorBlue">text <span class="fontColorBlue">#</span>SBATCH --ntasks &lt;n&gt;</span></em> should occur at the top of the script, before any commands. Otherwise, resources can also be specified on the <em><span class="fontColorBlue">sbatch</span></em> command when the job is submitted, eg.:<span class="fontSizeMedium"></span><br></p><pre>sbatch --ntasks &lt;n&gt; ...</pre>
<h4><span class="fontColorBlue">Contents on this page:</span></h4><p><a href="/sites/rc2/SitePages/SLURM-advanced-job-scripts.aspx#job-submission-scripts" data-cke-saved-href="https://wehieduau.sharepoint.com/sites/rc2/SitePages/SLURM-advanced-job-scripts.aspx#job-submission-scripts" data-interception="on" title="https://wehieduau.sharepoint.com/sites/rc2/SitePages/SLURM-advanced-job-scripts.aspx#job-submission-scripts"><span class="fontColorNeutralDark">Job submission scripts</span></a><br><a href="/sites/rc2/SitePages/SLURM-advanced-job-scripts.aspx#job-submission-script-structure" data-cke-saved-href="https://wehieduau.sharepoint.com/sites/rc2/SitePages/SLURM-advanced-job-scripts.aspx#job-submission-script-structure" data-interception="on" title="https://wehieduau.sharepoint.com/sites/rc2/SitePages/SLURM-advanced-job-scripts.aspx#job-submission-script-structure">Job submission: script structure</a><br><a href="/sites/rc2/SitePages/SLURM-advanced-job-scripts.aspx#part-1" data-cke-saved-href="https://wehieduau.sharepoint.com/sites/rc2/SitePages/SLURM-advanced-job-scripts.aspx#part-1" data-interception="on" title="https://wehieduau.sharepoint.com/sites/rc2/SitePages/SLURM-advanced-job-scripts.aspx#part-1">Part 1</a><br><a href="/sites/rc2/SitePages/SLURM-advanced-job-scripts.aspx#part-2" data-cke-saved-href="https://wehieduau.sharepoint.com/sites/rc2/SitePages/SLURM-advanced-job-scripts.aspx#part-2" data-interception="on" title="https://wehieduau.sharepoint.com/sites/rc2/SitePages/SLURM-advanced-job-scripts.aspx#part-2">Part 2</a><br><a href="/sites/rc2/SitePages/SLURM-advanced-job-scripts.aspx#output-and-error-files" data-cke-saved-href="https://wehieduau.sharepoint.com/sites/rc2/SitePages/SLURM-advanced-job-scripts.aspx#output-and-error-files" data-interception="on" title="https://wehieduau.sharepoint.com/sites/rc2/SitePages/SLURM-advanced-job-scripts.aspx#output-and-error-files">Output and error files</a><br><a href="/sites/rc2/SitePages/SLURM-advanced-job-scripts.aspx#configure-your-script-to-send-emails" data-cke-saved-href="https://wehieduau.sharepoint.com/sites/rc2/SitePages/SLURM-advanced-job-scripts.aspx#configure-your-script-to-send-emails" data-interception="on" title="https://wehieduau.sharepoint.com/sites/rc2/SitePages/SLURM-advanced-job-scripts.aspx#configure-your-script-to-send-emails">Configure your script to send emails</a><br><a href="/sites/rc2/SitePages/SLURM-advanced-job-scripts.aspx#part-3" data-cke-saved-href="https://wehieduau.sharepoint.com/sites/rc2/SitePages/SLURM-advanced-job-scripts.aspx#part-3" data-interception="on" title="https://wehieduau.sharepoint.com/sites/rc2/SitePages/SLURM-advanced-job-scripts.aspx#part-3">Part 3</a><br><a href="/sites/rc2/SitePages/SLURM-advanced-job-scripts.aspx#summary-of-sbatch-options-directives" data-cke-saved-href="https://wehieduau.sharepoint.com/sites/rc2/SitePages/SLURM-advanced-job-scripts.aspx#summary-of-sbatch-options-directives" data-interception="on" title="https://wehieduau.sharepoint.com/sites/rc2/SitePages/SLURM-advanced-job-scripts.aspx#summary-of-sbatch-options-directives">Summary of sbatch options directives</a><br><a href="/sites/rc2/SitePages/SLURM-advanced-job-scripts.aspx#environment-variables" data-cke-saved-href="https://wehieduau.sharepoint.com/sites/rc2/SitePages/SLURM-advanced-job-scripts.aspx#environment-variables" data-interception="on" title="https://wehieduau.sharepoint.com/sites/rc2/SitePages/SLURM-advanced-job-scripts.aspx#environment-variables">Environment variables</a><br><a href="/sites/rc2/SitePages/SLURM-advanced-job-scripts.aspx#sample-scripts" data-cke-saved-href="https://wehieduau.sharepoint.com/sites/rc2/SitePages/SLURM-advanced-job-scripts.aspx#sample-scripts" data-interception="on" title="https://wehieduau.sharepoint.com/sites/rc2/SitePages/SLURM-advanced-job-scripts.aspx#sample-scripts">Sample scripts</a></p>
<div class="canvasRteResponsiveTable"><div class="tableCenterAlign tableWrapper"><table style="width:1086px;" class=" cke_show_border"><tbody><tr><td rowspan="2" style="width:107px;"><p style="text-align:center;" align="center"><br><br><span class="fontColorRed"><b>Note:</b></span></p><p style="text-align:center;" align="center"><br></p></td><td style="vertical-align:top;width:926px;"><p><span><span><span><span>Any white space in front of <span class="fontColorBlue"><i>#SBATCH</i></span> will prevent sbatch from interpreting the resource requests. If you want to add comments into your script, type <span class="fontColorBlue"><i>#[space]&lt;comment&gt;</i></span>, eg:</span></span></span></span></p><pre style="margin-left:80px;"><span class="fontColorRed"><span class="fontSizeMedium">#SBATCH --job-name=test1_job # Job name</span></span></pre></td></tr><tr><td style="vertical-align:top;width:926px;"><p><span><span><span class="fontColorBlue"><i>#SBATCH</i></span><span> must be at the very top of the script, directly after the <span class="fontColorBlue"><i>#!/bin/bash</i></span>.<br><br><strong><span>If any command is run before it, the directives will be ignored and never used for the job.</span></strong></span></span></span></p></td></tr></tbody></table></div></div>
<h3><span class="fontColorThemeSecondary">Output and error files</span></h3><p>As your job runs, it will create a log file that contains both stdout and stderr streams. The default file name is <em><span class="fontColorBlue">SLURM-%j.out</span></em> where <em><span class="fontColorBlue">%j</span></em> is replaced by the job ID.</p><p>You specify the output file name with the #SBATCH/command line option <em><span class="fontColorBlue">--output</span></em>. And, you can optionally separate stderr into a different file by using the <em><span class="fontColorBlue">--error</span></em> option. But, make sure you include the <em><span class="fontColorBlue">jobid</span></em> in filenames so they aren't overwritten if the job is rerun. For example:</p><pre>#SBATCH --output &lt;filename&gt;\n#SBATCH --error &lt;filename&gt;</pre><p>By default, the files are saved to the current directory where the sbatch command was executed. To specify an alternative path, use:<span data-cke-bookmark="1" style="display:none;" id="cke_bm_11473E">&nbsp;</span></p><pre>#SBATCH --output /&lt;directoryfilepath&gt;/output.%j.%N.log</pre><ul><li><em><span class="fontColorBlue">/&lt;directoryfilepath&gt;/</span></em> = the directory filepath where you want the file to save.</li><li><em><span class="fontColorBlue">%j</span></em> = job id of the running job will become a part of the filename.</li><li><em><span class="fontColorBlue">%N</span></em> = hostname. This will create a separate IO file per node.<br><br></li></ul><p>The result will be a file name similar to <span class="fontColorBlue"><em>output.1288422.milton-sml-015.log</em></span>, if job id was <em><span class="fontColorBlue">1288422</span></em> and running on <em><span class="fontColorBlue">milton-sml-015</span></em> node.</p>
<p><strong><span class="fontColorThemeSecondary">If you add</span> <span class="fontColorBlue"><em>%x</em></span> <span class="fontColorThemeSecondary">into the command string, the job name will be added to the file name.</span></strong></p>
<p>The output file will show you the output of the programs running in your script, eg. if you have any ‘echo’ lines, these will be visible. However, the error file is produced <strong>only</strong> if there was trouble running the job.</p>
<p><strong>It is not best practice to submit a job from the home directory as it is limited in space.</strong></p><p><strong>We, therefore, recommend jobs are started from a faster disk/filesystem such as your lab/project/scratch share.</strong></p>
<h3><span class="fontColorThemeSecondary">Configure your script to send emails</span></h3><p>To configure your script to send emails you need to set <em><span class="fontColorBlue">--mail-user</span></em> and <em><span class="fontColorBlue">mail-type</span></em><span class="fontColorBlue"><span class="fontColorThemeDarker">.</span></span></p><pre>#SBATCH --mail-type=ALL\n#SBATCH --mail-user=&lt;username@wehi.edu.au&gt;\n</pre><p>More details in the <a href="/sites/rc2/SitePages/SLURM-advanced-job-scripts.aspx#summary-of-sbatch-options-directives" data-cke-saved-href="https://wehieduau.sharepoint.com/sites/rc2/SitePages/SLURM-advanced-job-scripts.aspx#summary-of-sbatch-options-directives" data-interception="on" title="https://wehieduau.sharepoint.com/sites/rc2/SitePages/SLURM-advanced-job-scripts.aspx#summary-of-sbatch-options-directives">summary table below</a>.</p><h4><span class="fontColorBlue">Part 3</span></h4><p>Then the final part of the script should contain the sequence of commands needed to run your job, eg.</p><pre>cd /stornext/General/data/test/ \nmodule load python\npython my.py\n</pre><ul><li><em><span class="fontColorBlue">cd</span></em> changes the working directory to <em><span class="fontColorBlue">/stornext/General/data/test/</span></em>.</li><li><em><span class="fontColorBlue">module load python</span></em> prepares the environment to run Python</li><li>Then the program runs on the resources allocated. In this example, it runs <em><span class="fontColorBlue">python</span></em>, specifying <em><span class="fontColorBlue">my.py</span></em> in the current directory<br><span class="fontColorBlue"><em>/stornext/General/data/test</em></span>.</li></ul>
<h2>Summary of <span class="fontColorBlueLight"><span class="fontColorBlue">sbatch</span> </span>options/directives</h2><p>These options can be specified as directives or options on the <em><span class="fontColorBlue">sbatch</span></em> command.</p><div class="canvasRteResponsiveTable"><div class="tableLeftAlign tableWrapper"><table style="width:1138px;" class="bandedRowColumnTableStyleTheme cke_show_border"><tbody><tr><td role="columnheader" style="text-align:center;width:133px;"><span class="fontColorYellowLight">Resource</span></td><td role="columnheader" style="text-align:center;width:360px;"><span class="fontColorYellowLight"><strong>Syntax</strong></span></td><td role="columnheader" style="text-align:center;width:224px;"><span class="fontColorYellowLight"><strong>Description</strong></span></td><td role="columnheader" style="text-align:center;width:317px;"><span class="fontColorYellowLight"><strong>Notes</strong></span></td></tr><tr><td role="rowheader" style="width:133px;"><strong>Job name</strong></td><td style="width:360px;"><pre><span class="fontSizeMedium">--job-name&lt;jobname&gt;</span></pre><p>or</p><pre><span class="fontSizeMedium">-j &lt;jobname&gt;</span></pre></td><td style="width:224px;">A name for your job</td><td style="width:317px;">Default is the script name</td></tr><tr><td role="rowheader" style="width:133px;"><strong>Partition</strong></td><td style="width:360px;"><pre><span class="fontSizeMedium">--partition &lt;partition name&gt;</span></pre><p>or</p><pre><span class="fontSizeMedium">-p &lt;partition name&gt;</span></pre></td><td style="width:224px;">Partition is a queue for jobs</td><td style="width:317px;"><br></td></tr><tr><td role="rowheader" style="width:133px;"><strong>Time limit</strong></td><td style="width:360px;"><pre><span class="fontSizeMedium">--time hh:mm:ss</span></pre><p>or</p><pre><span class="fontSizeMedium">-t hh:mm:ss</span></pre></td><td style="width:224px;">Maximum wall time</td><td style="width:317px;">Each partition has its default wall time</td></tr><tr><td role="rowheader" style="width:133px;"><strong>CPUs/cores</strong></td><td style="width:360px;"><pre><span class="fontSizeMedium">--cpus-per-task &lt;integer&gt;</span></pre><p>or</p><pre><span class="fontSizeMedium">-c &lt;integer&gt;</span></pre></td><td style="width:224px;">Number of cores per job task</td><td style="width:317px;">Default is 1</td></tr><tr><td role="rowheader" style="width:133px;"><strong>Nodes</strong></td><td style="width:360px;"><pre><span class="fontSizeMedium">--nodes &lt;integer&gt;</span></pre><p>or</p><pre><span class="fontSizeMedium">-N &lt;integer&gt;</span></pre></td><td style="width:224px;">Number of compute nodes for the job</td><td style="width:317px;">Default is 1</td></tr><tr><td role="rowheader" style="width:133px;"><strong>Tasks</strong></td><td><pre><span class="fontSizeMedium">--ntasks &lt;integer&gt;</span></pre><p>or</p><pre><span class="fontSizeMedium">-n &lt;integer&gt;</span></pre></td><td style="width:224px;">Number of tasks per node</td><td style="width:317px;">Default is 1</td></tr><tr><td role="rowheader" style="width:133px;"><strong>Resource feature</strong></td><td><pre><span class="fontSizeMedium">--gres=gpu:1</span></pre></td><td style="width:224px;">Request special features such as GPU</td><td style="width:317px;">eg. 1 GPU card</td></tr><tr><td role="rowheader" style="width:133px;"><strong>Memory</strong></td><td><pre><span class="fontSizeMedium">--mem=&lt;integer&gt;G</span></pre></td><td style="width:224px;">Memory per node</td><td style="width:317px;">In GB</td></tr><tr><td role="rowheader" style="width:133px;"><strong>Memory per CPU</strong></td><td><pre><span class="fontSizeMedium">--mem-per-cpu=&lt;integer&gt;G</span></pre></td><td style="width:224px;">Memory per CPU</td><td style="width:317px;">In GB</td></tr><tr><td role="rowheader" style="width:133px;"><strong>Output file</strong></td><td><pre><span class="fontSizeMedium">--output=&lt;filename pattern&gt;</span></pre></td><td style="width:224px;">A file to capture stdout and stderr by default</td><td style="width:317px;">Default is job id</td></tr><tr><td role="rowheader" style="width:133px;"><strong>Error file</strong></td><td><pre><span class="fontSizeMedium">--error=&lt;filename pattern&gt;</span></pre></td><td style="width:224px;">A file to capture stderr instead of going to output file</td><td style="width:317px;">Default is job id</td></tr><tr><td role="rowheader" style="width:133px;"><strong>Email notification</strong></td><td><pre><span class="fontSizeMedium">--mail-type=&lt;option&gt;</span></pre></td><td style="width:224px;">When to receive email notifications</td><td style="width:317px;"><p>Default is NONE. Values include NONE, BEGIN, END, FAIL, REQUEUE, ALL (equivalent to BEGIN, END, FAIL, INVALID_DEPEND, REQUEUE, and STAGE_OUT), INVALID_DEPEND, TIME_LIMIT, TIME_LIMIT_90 (reached 90 percent of time limit), TIME_LIMIT_80 (reached 80 percent of time limit), TIME_LIMIT_50 (reached 50 percent of time limit) and ARRAY_TASKS (send emails for each array task)</p></td></tr><tr><td role="rowheader" style="width:133px;"><strong>Email address</strong></td><td><pre><span class="fontSizeMedium">--mail-user=&lt;email address&gt;</span></pre></td><td style="width:224px;">Email address to receive notifications</td><td style="width:317px;"><br></td></tr></tbody></table></div></div><h3><span class="fontColorThemeSecondary">Environment Variables</span></h3><p>SLURM provides a number of environment variables that you can use inside your script during execution. These are some of the more useful ones.</p><div class="canvasRteResponsiveTable"><div class="tableWrapper"><table style="width:553px;" class="filledHeaderTableStyleNeutral cke_show_border"><tbody><tr><td role="columnheader" style="width:202px;">Variable</td><td role="columnheader" style="width:299px;">Contents</td></tr><tr><td style="width:202px;">SLURM_JOB_ID</td><td style="width:299px;">Job id</td></tr><tr><td style="width:202px;">SLURM_SUBMIT_DIR</td><td style="width:299px;">Directory job was submitted in</td></tr><tr><td style="width:202px;">SLURM_SUBMIT_HOST</td><td style="width:299px;">Host job was submitted from</td></tr><tr><td style="width:202px;">SLURM_JOB_NODELIST</td><td style="width:299px;">Nodes assigned to this job</td></tr></tbody></table></div></div><h3><span class="fontColorThemeSecondary">Sample scripts</span></h3><p>All sample scripts can be found at <strong><em><span class="fontColorBlue">/stornext/System/data/apps/sample-scripts/</span></em></strong></p>
<h3>Using other interpreters besides bash</h3><p>At the start of the page, we make note of the need to include an interpreter. <strong>But did you know you can change this to another interpreter like Rscript or Python? </strong>Doing this avoids the need to write seperate shell scripts that run your R/Python script.</p><h4>Rscript</h4><p>To submit an R script directly using sbatch, you need to add the path to an Rscript interpreter to the "hash bang" statement:</p><pre>$ cat R-demo.R\n#!/stornext/System/data/apps/R/R-4.2.3/lib64/R/bin/Rscript\n\nprint("Hello from inside an R script submitted with sbatch!")\na = rnorm(10000)\nprint(paste("The mean of a is:", mean(a)))</pre><p>In the example above, I use the Rscript from the R/4.2.3 module. If you have a specific R version that you prefer, you can use "module show R/&lt;version&gt;", note the "R_HOME" variable, and add that string to the hash bang statement with /bin/Rscript at the end.</p><p>If I submit the script, wait for it to complete, and read the output file:</p><pre><span class="fontColorBlue">$ sbatch R-demo.R</span>\nSubmitted batch job 11049605\n\n<span class="fontColorBlue">$ cat slurm-11049605.out</span>\n[1] "Hello from inside an R script submitted with sbatch!"\n[1] "The mean of a is: 0.0146303369869466"\n</pre><p>You can see that the Rscript worked!</p><p>SBATCH options are specified in the same way as bash scripts. You can also access Slurm environment variables using the Sys.getenv function:</p><pre><span class="fontColorBlue">$ cat R-demo.R</span>\n#!/stornext/System/data/apps/R/R-4.2.3/lib64/R/bin/Rscript\n#SBATCH --job-name=myjobname\n\nprint("Hello from inside an R script submitted with sbatch!")\na = rnorm(10000)\nprint(paste("The mean of a is:", mean(a)))\nprint(paste("My job ID is:", Sys.getenv("SLURM_JOB_ID")))\nprint(paste("My job name is:", Sys.getnev("SLURM_JOB_NAME")))\n\n<span class="fontColorBlue">$ sbatch --mem=1G R-demo.R</span>\nSubmitted batch job 11049661\n\n<span class="fontColorBlue">$ cat slurm-11049661.out</span>\n[1] "Hello from inside an R script submitted with sbatch!"\n[1] "The mean of a is: 0.00652377529642266"\n[1] "My job ID is: 11049661"\n[1] "My job name is: myjobname"\n</pre><h4>Python</h4><p>Like R, you can choose whichever Python you like. If you have a virtual environment or conda environment you want to use in your script, you can point to that Python executable and all the packages in that environment should be available. Like R, the Python function for retrieving environment variables should be used to access Slurm environment variables.</p><pre><span class="fontColorBlue">$ cat py-demo.py</span>\n#!/vast/projects/RCP/demo-venv/bin/python\n#SBATCH --job-name=myjobname\n\nprint("Hello from inside a Python script submitted with sbatch!")\n\nimport random,os\n\na = [random.random() for i in range(10000)]\n\nprint("The mean of a is: " + str(sum(a)/len(a)))\nprint("My job ID is: " + os.getenv("SLURM_JOB_ID"))\nprint("My job name is: " + os.getenv("SLURM_JOB_NAME"))\n\n<span class="fontColorBlue">$ sbatch --mem=1G py-demo.py</span>\nSubmitted batch job 11049777\n\n<span class="fontColorBlue">$ cat slurm-11049777.out</span>\nHello from inside a Python script submitted with sbatch!\nThe mean of a is: 0.5005749778622748\nMy job ID is: 11049777\nMy job name is: myjobname\n</pre>
