<h3><span class="fontColorThemeSecondary">Background</span></h3><p>Lftp is a file transfer that can be used in place of other tools like ftp and sftp. Like the aforementioned tools, lftp is a command line utility. The benefit of Lftp is that it can transfer over multiple protocols (HTTP, HTTPS, FTP, SFTP and others), whereas ftp and sftp utilities each can only transfer over the FTP and SFTP protocols, respectively. lftp can automatically retry transfers if the connection is lost, perform transfers in the background, and perform parallel transfers. It's also a good alternative to rsync when SSH access is not available (e.g., uploading data to NCBI from Milton).<br></p><h3>Connecting to a server</h3><p>You initiate a connection with a server by passing a username and hostname to the command. This creates an interactive session with which you can change directories, list directory contents, and upload/download files.</p><pre>$ lftp username@domain.com:/directory/to/change/to\nPassword:    # enter your password here\ncd ok, cwd /directory/to/change/to\n\nlftp username@domain.com:/directory/to/change/to&gt; \n</pre><p>In some cases, you may need to add the protocol to specify. E.g., if you wish to download things from milton to your laptop, you will need to use sftp:</p><pre>lftp sftp://username@slurm-login</pre><p>which would put me in your home directory on Milton.</p><p>You can then change folders with "cd" in a manner similar to your normal shell</p><pre>lftp username@domain.com:/directory/to/change/to&gt; cd /my/other/directory\ncd ok, cwd /my/other/directory\n\nlftp username@domain.com:/my/oher/directory&gt;\n</pre><p>Contents of directories, like in a shell, are listed with "ls", although it defaults to "long listings"</p><pre>lftp username@domain.com:/my/other/directory&gt; ls\ndrwxr-sr-x&nbsp;&nbsp;&nbsp; 2 username&nbsp;&nbsp; mygroup&nbsp;&nbsp;&nbsp;&nbsp; 4096 Feb 23 13:08 .\ndrwxrws---&nbsp;&nbsp;&nbsp; 2 username&nbsp;&nbsp; mygroup&nbsp;&nbsp;&nbsp;&nbsp; 4096 Feb 23 13:07 ..\n-rw-r--r--&nbsp;&nbsp;&nbsp; 1 username&nbsp;&nbsp; mygroup 10737418240 Feb 23 13:06 largefile1\n-rw-r--r--&nbsp;&nbsp;&nbsp; 1 username&nbsp;&nbsp; mygroup 10737418240 Feb 23 13:08 largefile2\n</pre><h3>Getting help</h3><p>the "help" command can always be executed in an lftp interactive session to get informtion about the commands available.</p><pre>lftp username@domain.com:/my/other/directory&gt; help\n&nbsp;&nbsp;&nbsp; !&lt;shell-command&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (commands)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; alias [&lt;name&gt; [&lt;value&gt;]]\n&nbsp;&nbsp;&nbsp; attach [PID]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; bookmark [SUBCMD]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cache [SUBCMD]\n&nbsp;&nbsp;&nbsp; cat [-b] &lt;files&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cd &lt;rdir&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; chmod [OPTS] mode file...\n&nbsp;&nbsp;&nbsp; close [-a]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [re]cls [opts] [path/][pattern]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; debug [OPTS] [&lt;level&gt;|off]\n&nbsp;&nbsp;&nbsp; du [options] &lt;dirs&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; edit [OPTS] &lt;file&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; exit [&lt;code&gt;|bg]\n&nbsp;&nbsp;&nbsp; get [OPTS] &lt;rfile&gt; [-o &lt;lfile&gt;]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; glob [OPTS] &lt;cmd&gt; &lt;args&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; help [&lt;cmd&gt;]\n&nbsp;&nbsp;&nbsp; history -w file|-r file|-c|-l [cnt]&nbsp; jobs [-v] [&lt;job_no...&gt;]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; kill all|&lt;job_no&gt;\n&nbsp;&nbsp;&nbsp; lcd &lt;ldir&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; lftp [OPTS] &lt;site&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ln [-s] &lt;file1&gt; &lt;file2&gt;\n&nbsp;&nbsp;&nbsp; ls [&lt;args&gt;]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mget [OPTS] &lt;files&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mirror [OPTS] [remote [local]]\n&nbsp;&nbsp;&nbsp; mkdir [OPTS] &lt;dirs&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; module name [args]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; more &lt;files&gt;\n&nbsp;&nbsp;&nbsp; mput [OPTS] &lt;files&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mrm &lt;files&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mv &lt;file1&gt; &lt;file2&gt;\n&nbsp;&nbsp;&nbsp; mmv [OPTS] &lt;files&gt; &lt;target-dir&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [re]nlist [&lt;args&gt;]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; open [OPTS] &lt;site&gt;\n&nbsp;&nbsp;&nbsp; pget [OPTS] &lt;rfile&gt; [-o &lt;lfile&gt;]&nbsp;&nbsp;&nbsp;&nbsp; put [OPTS] &lt;lfile&gt; [-o &lt;rfile&gt;]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pwd [-p]\n&nbsp;&nbsp;&nbsp; queue [OPTS] [&lt;cmd&gt;]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; quote &lt;cmd&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; repeat [OPTS] [delay] [command]\n&nbsp;&nbsp;&nbsp; rm [-r] [-f] &lt;files&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; rmdir [-f] &lt;dirs&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; scache [&lt;session_no&gt;]\n&nbsp;&nbsp;&nbsp; set [OPT] [&lt;var&gt; [&lt;val&gt;]]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; site &lt;site-cmd&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; source &lt;file&gt;\n&nbsp;&nbsp;&nbsp; torrent [OPTS] &lt;file|URL&gt;...&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; user &lt;user|URL&gt; [&lt;pass&gt;]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; wait [&lt;jobno&gt;]\n&nbsp;&nbsp;&nbsp; zcat &lt;files&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; zmore &lt;files&gt;\n</pre><p>To get more information about a single command, add the command of interest to the help command</p><pre>lftp username@domain.com:/my/other/directory&gt; help pget\n\nUsage: pget [OPTS] &lt;rfile&gt; [-o &lt;lfile&gt;]\nGets the specified file using several connections. This can speed up transfer,\nbut loads the net heavily impacting other users. Use only if you really\nhave to transfer the file ASAP.\n\nOptions:\n -c  continue transfer. Requires &lt;lfile&gt;.lftp-pget-status file.\n -n &lt;maxconn&gt;  set maximum number of connections (default is is taken from\n     pget:default-n setting)\n -O &lt;base&gt; specifies base directory where files should be placed</pre><h3>Uploading and downloading with put and get</h3><p>Once you've navigated to the remote server directory in which you would like to upload or download your file from, you can execute put or get &lt;filename&gt; to transfer the file. For example</p><pre>lftp username@domain.com:/my/other/directory&gt; get largefile1</pre><p>will download "largefile1" into the current directory on your computer. If you wish to change this directory, use the "lcd" (local cd) command.</p><pre>lftp username@domain.com:/my/other/directory&gt; lcd ~/Downloads\nlcd ok, local cwd=/Users/username/Downloads\n</pre><p>Which moves me to my Downloads folder. If I were to run "get largefile1" now, the file would download into ~/Downloads. Note that relative and absolute paths can also be used.</p><p>Put works similarly, except instead of getting a file from the server and placing it in the local directory, it takes a file in the local directory and "puts" it on the server.</p><pre>lftp username@domain.com:/my/other/directory&gt; put alocalfile\n</pre><p>this uploads "alocalfile" from the local server/computer to the remote server (in this case, domain.com).</p><h3>Transfers in the background</h3><p>Like with sh, you can ues add an ampersand to the end of a transfer command and it will then run in the background</p><pre>lftp username@domain.com:/my/other/directory&gt; get largefile1 &amp;\nget largefile1 &amp;\n&nbsp;&nbsp; &nbsp;`largefile1' at 0 \n\nlftp username@domain.com:/my/other/directory&gt; get largefile2 &amp;\nget largefile2 &amp;\n&nbsp;&nbsp; &nbsp;`largefile2' at 1 \n\nlftp username@domain.com:/my/other/directory&gt; jobs\n[1] get largefile2&nbsp; -- 2.34 MiB/s\n&nbsp;&nbsp; &nbsp;`largefile2' at 27131904 (0%) 2.34M/s eta:73m [Receiving data]\n[0] get largefile1&nbsp; -- 1.61 MiB/s\n&nbsp;&nbsp; &nbsp;`largefile1' at 33259520 (0%) 1.61M/s eta:1h45m [Receiving data]\n</pre><p>Or, if you've already executed a command, you can put it to the background with CTRL+z. Unlike sh, this doesn't pause the command, but puts it straight to running in the background.</p><p>Closing the session will not cancel the background transfers - they will continue in the background.</p><pre>lftp username@domain.com:/my/other/directory&gt; get largefile1 &amp;\nget largefile1 &amp;\n&nbsp;&nbsp; &nbsp;`largefile1' at 0 \n\nlftp username@domain.com:/my/other/directory&gt; exit\n[63409] Moving to background to complete transfers...\n\n$ # back to my normal shell\n</pre><p>You can then reattach by starting another lftp session and executing "attach &lt;pid&gt;"</p><pre>$ lftp\nlftp :~&gt; attach 63409\nlftp username@domain.com:/my/other/directory&gt; jobs\n[0] get largefile1&nbsp; -- 1.47 MiB/s\n&nbsp;&nbsp; &nbsp;`largefile1' at 322306048 (3%) 1.47M/s eta:2h21m [Receiving data]\n</pre><p>if you forget which process ID the lftp job was given, you can use pgrep in your normal shell:</p><pre>$ pgrep lftp\n63409\n</pre><p>In the lftp session, you can kill your jobs like in shell, with the "kill" command and passing the job id.</p><pre>lftp username@domain.com:/my/other/directory&gt; kill 0\n</pre><p>will stop the download of largefile1.</p><h3>Parallel Puts and Gets</h3><p>In some cases, opening more connections to download/upload from/to the remote machine can speed up the process. Both put and get commands have a parallel version "pput" and "pget" i.e., parallel put and parallel get.</p><pre>lftp username@domain.com:/my/other/directory&gt; pget largefile1\n</pre><p>will automatically create 5 parallel connections to download the largefile1 file. You can control the number of connections opened with the -n option. e.g. "pget -n 2 &lt;file&gt;" will open 2 parallel connections to download &lt;file&gt;. As an example, we can download a 9GB file from ftp.ncbi.nlm.nih.gov onto Milton using get and pget:</p><pre>$ lftp ftp.ncbi.nlm.nih.gov\n\n# Download using serial get\nlftp ftp.ncbi.nlm.nih.gov:~&gt; get gene/DATA/GENE_INFO/All_Data.gene_info.gz\n919139558 bytes transferred in 125 seconds (6.99M/s)\n\n# Download using parallel pget (-o specifies the local file name to use)\nlftp ftp.ncbi.nlm.nih.gov:~&gt; pget -o All_Data.gene_info.gz.2 gene/DATA/GENE_INFO/All_Data.gene_info.gz\n919149724 bytes transferred in 44 seconds (19.75M/s)\n</pre><p>Pget with the default 5 parallel connections speeds up the transfer by almost 3x!</p><h3>Mirroring</h3><p>lftp can sync remote and local directories with the "mirror" command. This works in a similar to rsync in that it will only download files that don't exist in the destination directory. However, it is less powerful than rsync in that it cannot identify byte-level differences. It will instead redownload the entire file if it notices a difference.</p><pre>lftp username@domain.com:/my/other/directory&gt; mirror /source /destination</pre><p>This command will update the /destination folder on the local machine, to be the same as /source on the remote machine.</p><p>Mirror can also use parallel connections by supplying the -P option</p><pre>lftp username@domain.com:/my/other/directory&gt; mirror -P 5 .\n</pre><p>will sync the current directory "." to the current local directory with 5 parallel connections.</p>
