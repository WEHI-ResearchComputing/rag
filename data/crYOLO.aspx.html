<h2>crYOLO</h2><p><a data-cke-saved-href="https://cryolo.readthedocs.io/en/stable/" href="https://cryolo.readthedocs.io/en/stable/">crYOLO</a>, an application for fast and accurate cryo-EM particle picking. It’s based on convolutional neural networks and utilizes the popular <span class="fontColorRed"><span class="highlightColorGrey">You Only Look Once</span></span> (YOLO) object detection system.</p><p>You can use a general network model and skip training completely. However, if the general model doesn’t give you satisfactory results or if you would like to improve them, you might want to <a data-cke-saved-href="https://cryolo.readthedocs.io/en/stable/tutorials/tutorial_overview.html#tutorial-2-pick-particles-by-training-a-model-for-your-data" href="https://cryolo.readthedocs.io/en/stable/tutorials/tutorial_overview.html#tutorial-2-pick-particles-by-training-a-model-for-your-data" target="_blank" title="https://cryolo.readthedocs.io/en/stable/tutorials/tutorial_overview.html#tutorial-2-pick-particles-by-training-a-model-for-your-data" data-interception="off">train a specialized model</a> specific for your data set by selecting particles on a small number of micrographs. It was developed by the Department of Structural Biochemistry, Max Planck Institute of Molecular.</p><p>The below tutorial was provided by Dr. Alisa Glukhova.</p>
<h2><span class="fontColorThemeSecondary">Steps to run crYOLO on Milton (RELION)<br>​​​​​​​</span></h2><div class="canvasRteResponsiveTable"><div class="tableWrapper"><table style="width:519px;" class=" cke_show_border"><tbody><tr><td style="width:9px;">1</td><td style="width:446px;"><p>Create directory <em><span class="fontColorBlue">cryolo/fulldata</span></em>&nbsp; (best inside your project directory):</p><pre><span class="fontSizeMedium">mkdir -p cryolo/fulldata\ncd cryolo/fulldata</span></pre></td></tr><tr><td style="width:9px;">2</td><td style="width:446px;"><p>Link mrc files from motion correction job. You can link either DW or noDW. I usually do noDW (better signal/noise):</p><pre><span class="fontSizeMedium">​​​​​​​​​​​​​​ln -s ../../MotionCorr/jobXXX/Micrographs/*_noDW.mrc .\n​​​​​​​​​​​​​​cd ../</span></pre></td></tr><tr><td style="width:9px;">3</td><td style="width:446px;"><p>Copy <strong>config.json</strong>, <strong>cryolo.bash</strong> and the network file (e.g “gmodel_phosnet_202002_N63.h5”) from from&nbsp;<span class="fontColorBlue"><strong>/stornext/System/data/apps/sample-scripts/cryoem/cryolo</strong></span> into the cryolo directory into&nbsp;<em><span class="fontColorBlue">cryolo&nbsp;</span></em>directory.</p><p>Note that there might be better networks available for picking, as they are regularly updated&nbsp;–&nbsp; <a data-interception="off" title="https://cryolo.readthedocs.io/en/stable/installation.html#download-the-general-modelscheck" href="https://cryolo.readthedocs.io/en/stable/installation.html#download-the-general-modelscheck" data-cke-saved-href="https://cryolo.readthedocs.io/en/stable/installation.html#download-the-general-modelscheck" target="_blank">check here</a>. Also, if you are picking negative stain micrographs or micrographs that were denoised with Janni- there are specialised networks available.</p></td></tr><tr><td style="width:9px;">4</td><td style="width:446px;"><p>Submit script to slurm:</p><pre><span class="fontSizeMedium">sbatch cryolo.bash</span></pre></td></tr><tr><td style="width:9px;">5</td><td style="width:446px;">Check the <span class="fontColorBlue"><em>cryolo-XXXjobIDXX.out</em></span> and <span class="fontColorBlue"><em>cryolo -XXXjobIDXX.err</em></span>&nbsp;files in the&nbsp;<em><span class="fontColorBlue">cryolo</span></em> folder to make sure it is running.</td></tr><tr><td style="width:9px;">6</td><td style="width:446px;"><p>Check your picks and adjust the <strong><em><span class="fontColorBlue">t</span></em> </strong>parameter if needed:</p><pre><span class="fontSizeMedium">module load crYOLO\ncryolo_boxmanager.py //this will open gui selection window\nfile-&gt;open image files-&gt;fulldata\nfile-&gt;import box files -&gt;boxfiles-&gt;CBOX\n</span></pre></td></tr><tr><td style="width:9px;">7</td><td style="width:446px;">Check a couple of micrographs and make sure you are satisfied with the picks.</td></tr><tr><td style="width:9px;">8</td><td style="width:446px;">You can adjust “confidence threshold” if you want more or less picks (the <strong>cryolo.bash</strong> is picking with <strong>t=0.01</strong>)</td></tr><tr><td style="width:9px;">9</td><td style="width:446px;">Write new STAR (File-&gt;Write-&gt;STAR).</td></tr><tr><td style="width:9px;">10</td><td style="width:446px;"><p>After it finishes rename the picks (to add _pick suffix).</p><pre><span class="fontSizeMedium">Go to boxfiles-&gt;STAR\nrename '.star'  '_pick.star' * </span>\n</pre><p>If you used _noDW micrographs the command is rename <span class="fontColorBlue"><em>'_noDW.star'</em></span> <span class="fontColorBlue"><em>'_pick.star' *</em></span></p></td></tr><tr><td style="width:9px;">11</td><td style="width:446px;"><p>Link the picks back into the <span class="fontColorBlue"><em>MotionCorr/jobXXX/Micrographs</em></span> folder.</p><pre><span class="fontSizeMedium">cd ../../../MotionCorr/jobXXX/Micrographs\nln -s ../../../cryolo/boxfiles/STAR/*_pick.star</span></pre></td></tr><tr><td style="width:9px;">12</td><td style="width:446px;">Import the particles into relion through the Import type job <em><span class="fontColorBlue">(importing particle coordinates)-jobYYY</span></em></td></tr><tr><td style="width:9px;">13</td><td style="width:446px;"><p>If you want to open and examine the picks in relion, you need to fix the Import string</p><pre><span class="fontSizeMedium">cd Import/jobYYY\nvi coords_suffix_pick.star</span>\n</pre></td></tr><tr><td style="width:9px;">14</td><td style="width:446px;">Change <span class="fontColorBlue"><em>MotionCorr/jobXXX/Micrographs/*.mrc</em></span> to <span class="fontColorBlue"><em>"MotionCorr/jobXXX/Micrographs/*.mrc"</em></span> (add the double quotes).</td></tr></tbody></table></div></div><p><br></p><h3><br></h3><p><br></p>
<h2><span class="fontColorThemeSecondary">Steps to run crYOLO on Milton (cryoSPARC)<br>​​​​​​​</span></h2><div class="canvasRteResponsiveTable"><div class="tableWrapper"><table style="width:538px;" class=" cke_show_border"><tbody><tr><td style="width:9px;">1</td><td style="width:465px;"><p>Create directory <em><span class="fontColorBlue">cryolo/fulldata</span></em>&nbsp; (best inside your project directory):</p><pre><span class="fontSizeMedium">mkdir -p cryolo/fulldata\ncd cryolo/fulldata</span></pre></td></tr><tr><td style="width:9px;">2</td><td style="width:465px;"><p>Link mrc files from motion correction job. You can link either patch&nbsp;or whole mic, doseweighted, or not. I usually do non-doseweighted patch aligned&nbsp;(better signal/noise):</p><pre><span class="fontSizeMedium">​​​​​​​​​​​​​​ln -s path/to/P###/J###/motioncorrected/*_patch_aligned.mrc .\n​​​​​​​​​​​​​​cd ../</span></pre></td></tr><tr><td style="width:9px;">3</td><td style="width:465px;"><p>Copy <strong>config.json</strong>, <strong>cryolo.bash</strong> and the network file (e.g “gmodel_phosnet_202002_N63.h5”) from from&nbsp;<span class="fontColorBlue"><strong>/stornext/System/data/apps/sample-scripts/cryoem/cryolo&nbsp;</strong></span>into&nbsp;<em><span class="fontColorBlue">cryolo&nbsp;</span></em>directory.</p><p>Note that there might be better networks available for picking, as they are regularly updated&nbsp;–&nbsp; <a data-interception="off" title="https://cryolo.readthedocs.io/en/stable/installation.html#download-the-general-modelscheck" href="https://cryolo.readthedocs.io/en/stable/installation.html#download-the-general-modelscheck" data-cke-saved-href="https://cryolo.readthedocs.io/en/stable/installation.html#download-the-general-modelscheck" target="_blank">check here</a>. Also, if you are picking negative stain micrographs or micrographs that were denoised with Janni- there are specialised networks available.</p></td></tr><tr><td style="width:9px;">4</td><td style="width:465px;"><p>Submit script to slurm:</p><pre><span class="fontSizeMedium">sbatch cryolo.bash</span></pre></td></tr><tr><td style="width:9px;">5</td><td style="width:465px;">Check the <span class="fontColorBlue"><em>cryolo-XXXjobIDXX.out</em></span> and <span class="fontColorBlue"><em>cryolo -XXXjobIDXX.err</em></span>&nbsp;files in the&nbsp;<em><span class="fontColorBlue">cryolo</span></em> folder to make sure it is running.</td></tr><tr><td style="width:9px;">6</td><td style="width:465px;"><p>Check your picks and adjust the <strong><em><span class="fontColorBlue">t</span></em> </strong>parameter if needed:</p><pre><span class="fontSizeMedium">module load crYOLO\ncryolo_boxmanager.py //this will open gui selection window\nfile-&gt;open image files-&gt;fulldata\nfile-&gt;import box files -&gt;boxfiles-&gt;CBOX\n</span></pre></td></tr><tr><td style="width:9px;">7</td><td style="width:465px;">Check a couple of micrographs and make sure you are satisfied with the picks.</td></tr><tr><td style="width:9px;">8</td><td style="width:465px;">You can adjust “confidence threshold” if you want more or less picks (the <strong>cryolo.bash</strong> is picking with <strong>t=0.01</strong>).</td></tr><tr><td style="width:9px;">9</td><td style="width:465px;">Write new STAR (File-&gt;Write-&gt;STAR).</td></tr><tr><td style="width:9px;">10</td><td style="width:465px;"><p>After it finishes rename the picks (to add _pick suffix).</p><pre><span class="fontSizeMedium">Go to boxfiles-&gt;STAR\nrename '.star'  '_pick.star'* </span>\n</pre><p>If you used _noDW micrographs the command is rename <span class="fontColorBlue"><em>'_noDW.star'</em></span> <span class="fontColorBlue"><em>'_pick.star' *</em></span></p></td></tr><tr><td style="width:9px;">11</td><td style="width:465px;"><p>Link the picks back into the <span class="fontColorBlue"><em>fulldata</em></span> folder.</p><pre><span class="fontSizeMedium">cd ../../../cryolo/fulldata\nln -s path/to/your/cryolo/boxfiles/STAR/*_pick.star</span></pre></td></tr><tr><td style="width:9px;">12</td><td style="width:465px;">Import both the micrographs and picks (from <span class="fontColorBlue"><em>fulldata</em></span>) into relion through the Import type job&nbsp;</td></tr><tr><td style="width:9px;">13</td><td style="width:465px;"><p>Extract the particles using coords and mics (to create a star file with all coordinates)</p></td></tr><tr><td style="width:9px;">14</td><td style="width:465px;"><p>Import the particle coordinates into cryosparc:<br>​​​​​​​</p><ul><li>In the <em>Import Particle Stack</em> job enter the location of the <strong>Extract/particles.star</strong> file</li><li>Select <em>Ignore raw data</em></li><li>In <em>Length of input micrograph path suffix to cut</em> enter 17 (or a number that leaves patch_aligned as the end of the query)</li><li>In<em> Length of rlnMicrographName path suffix to cut for query</em> enter 4 (or a number that leaves patch_aligned as the end of the query)</li><li>In the micrographs area drag the corresponding motion correction job</li><li>Run the job</li></ul></td></tr><tr><td style="width:9px;">15</td><td style="width:465px;">Extract the particles using your CTF job as the micrographs to link the CTF parameters to the particles and continue processing.</td></tr></tbody></table></div></div><p><br></p><h3><br></h3><p><br></p>
<h3><span class="fontColorThemeSecondary">References</span></h3>
