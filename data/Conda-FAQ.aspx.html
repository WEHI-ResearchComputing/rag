<p>This page is dedicated to answering questions that RCP are frequently asked about using Conda/Micromamba. If you have a question that you know others have, or an answer to a question that you yourself get frequently asked, please send them to <a href="mailto:research.computing@wehi.edu.au">research.computing@wehi.edu.au</a>!</p>
<h2>My home directory is full after creating environments! How do I clean it up?</h2>
<h4>Cleaning Conda environments/packages</h4><p>Often, conda will download files used to install packages. By default, this directory is located in your home directory. If you've been installing packages and/or creating environments, it's possible that your home directory is filled with these files. Remove them with the command:</p><pre>conda/micromamba clean --all -y</pre><p>You can then ensure that future downloaded files aren't stored in your home directory by following the configuration instructions on our <a href="/sites/rc2/SitePages/Conda-on-Milton.aspx#storing-downloaded-packages-on-vast-scratch">Conda/Micromamba on Milton page</a>.</p><p>Another potential cause of a full home directory is due to the size/number of environments installed into your home directory. You can see whether whether you have environments installed into your home directory with</p><pre>$ micromamba env list<br>  Name  Active  Path                                                          <br>────────────────────────────────────────────────────────────────────────────────<br>               /home/users/allstaff/yang.e/vast-scratch/mambatestenv         <br>               /stornext/Home/data/allstaff/y/yang.e/micromamba/envs/condanev<br>               /stornext/Home/data/allstaff/y/yang.e/mytestenv               <br> base          /usr/bin/bash                                                 </pre><p>And then look for directories that are located in your home directory (the path should look like /stornext/Home/data/allstaff/…). Once you've identified the name and paths of the environments that are in your home directory, you can remove redundant environments with</p><pre>micromamba env remove -n &lt;env name&gt;<br># OR<br>micromamba env remove -p /path/to/env</pre><p>Or, you can remove redundant packages using a combination of “micromamba list” and “micromamba remove”. See our <a href="/sites/rc2/SitePages/Conda-on-Milton.aspx#managing-packages">Managing Packages section</a>.</p>
<h4>Cleaning pip packages</h4><p>Pip stores cached downloaded package files in a separate directory. Hence, you will need to clean it up differently. To clean up your pip cache, run:</p><pre>pip cache purge</pre><p>which will delete all your downloaded pip packages, which is usually located in ~/.cache/pip. You can also delete this directory manually.</p><p>You can ensure that pip doesn't save downloaded files by adding the following in your ~/.bashrc:</p><pre>export XDG_CACHE_HOME=/vast/scratch/users/$USER/tmp/cache</pre><p>Note that this will redirect other cached files to that directory too. It's unlikely that it will affect any program's behaviour meaningfully, besides minimizing cached files contributing to your home quota.</p>
<h2>Why is my conda-installed PyTorch only using CPUs?</h2><p>This is usually because the PyTorch that you've installed accidentally came from the conda-forge or defaults channel. The version of PyTorch on these channels are CPU-only. To get PyTorch that uses GPUs, use the following command:</p><pre>conda/micromamba install -c pytorch -c nvidia pytorch::pytorch pytorch::pytorch-cuda=11.8 pytorch::torchaudio pytorch::torchvision</pre><p>This command is a little lengthy so below is a breakdown:</p><ul><li>“-c pytorch -c nvidia” ensures the pytorch and nvidia channels are <i>also</i> used when searching for packages and dependencies. These are <i>in addition to</i> any channels you have configured and defaults. The pytorch channel is used to get the pytorch packages, whereas the nvidia channel is used to get the relevant CUDA libraries.</li><li>“pytorch::&lt;package&gt;” tells conda to install &lt;package&gt; from the pytorch channel. This should be sufficient to guarantee that all the pytorch packages come from the pytorch channel. We want to avoid using conda-forge or defaults channels because their versions of pytorch only use the CPU.</li></ul><p>When running this command, check that you got the correct packages before you enter “y" to continue with the install:</p><pre>  Package                      Version  Build                         Channel         Size<br>────────────────────────────────────────────────────────────────────────────────────────────<br> Install:<br>────────────────────────────────────────────────────────────────────────────────────────────<br> + pytorch-mutex                  1.0  cuda                          pytorch          3kB<br> + cuda-cudart                11.8.89  0                             nvidia         202kB<br> + cuda-cupti                 11.8.87  0                             nvidia          27MB<br> + cuda-nvrtc                 11.8.89  0                             nvidia          20MB<br> + cuda-nvtx                  11.8.86  0                             nvidia          58kB<br> + libcublas                11.11.3.6  0                             nvidia         382MB<br> + libcufft                 10.9.0.58  0                             nvidia         150MB<br> + libcusolver              11.4.1.48  0                             nvidia         101MB<br> + libcusparse              11.7.5.86  0                             nvidia         185MB<br> + libnpp                   11.8.0.86  0                             nvidia         155MB<br> + libnvjpeg                11.9.0.86  0                             nvidia           3MB<br> + libcufile                 1.7.2.10  0                             nvidia           1MB<br> + libcurand               10.3.3.141  0                             nvidia          54MB<br> + cuda-libraries              11.8.0  0                             nvidia           2kB<br> + cuda-runtime                11.8.0  0                             nvidia           1kB<br>... skipped output ...<br><span class="highlightColorYellow"> + pytorch-cuda                  11.8  h7e8668a_5                    pytorch          4kB</span><br>... skipped output ...<br><span class="highlightColorYellow"> + pytorch                      2.0.1  py3.11_cuda11.8_cudnn8.7.0_0  pytorch          2GB</span><br> + torchtriton                  2.0.0  py311                         pytorch         66MB<br><span class="highlightColorYellow"> + torchaudio                   2.0.2  py311_cu118                   pytorch          8MB</span><br>... skipped output ...<br><span class="highlightColorYellow"> + torchvision                 0.15.2  py311_cu118                   pytorch          9MB</span></pre><p>Note that the pytorch-cuda, pytorch, torchaudio, and torchvision packages are coming from the “pytorch” channel (4th column from the left). The incorrect PyTorch package would have “defaults” or “conda-forge” as the channel. You can also see in the pytorch version, that it looks like “py????_cuda????_cudnn?????_?” which should tell you that the PyTorch version will use CUDA. Once this is confirmed, you can continue with the installation. If you already have a PyTorch package installed, the above command should update the PyTorch version.</p><p>You can also confirm this after installation, with conda/micromamba list, which should show you similar information.&nbsp;</p><p>As a final check, with the environment active, you can execute the following command:</p><pre>$ srun -p gpuq --mem=1G --gres=gpu:A30:1 python -c "import torch; torch.cuda.is_available()"<br>True</pre><p>If it prints “True”, then you should be good to go.</p>
<h2>Can I use Conda for langauges other than Python?</h2><p>Yes! Conda, is a general package manager and includes system packages. Porbably most often, conda is used with Python, but it is also frequently used with R and Julia.</p><h3>R</h3><p>The conda-forge and defaults channels will have all R packages from CRAN, and the bioconda channel will have packages from Bioconductor. For example, you can create an environment with R and the edgeR package installed with:</p><pre>micromamba create -p ./test-r-env -c bioconda r r-base bioconductor-edger</pre><p>This will install all the packages to work with EdgeR, including R. You may also want to consider installing the “r-essentials” package. You can check which r packages are available with the “search” subcommand. For example: checking which CRAN packages compatible with R 4.3:</p><pre># CRAN packages:<br>micromamba search ‘r-*’ | grep r43<br><br># Bioconductor packages:<br>micromamba search -c bioconda 'bioconductor-*' | grep r43</pre><p>This command searches for packages with the “r-” prefix, as all CRAN packages will have this prefix. Then, the output is piped to grep, to search for lines that have r43 in them. This corresponds to packages built for R 4.3. Example output:</p><pre>r-academictwitter                 0.3.1          r43hc72bb7e_2         (+  5 builds) conda-forge noarch  <br>r-additivitytests                 1.1_4.1        r43hc72bb7e_2         (+  5 builds) conda-forge noarch  <br>r-adehabitathr                    0.4.21         r43h57805ef_1         (+  3 builds) conda-forge linux-64<br>r-adgoftest                       0.3            r43ha770c72_1005      (+ 14 builds) conda-forge noarch  <br>r-admisc                          0.33           r43hc72bb7e_0         (+  1 builds) conda-forge noarch  <br>r-admm                            0.3.3          r43h08d816e_1         (+  2 builds) conda-forge linux-64<br>... More output ...</pre><p>But if you deem necessary, you can also install packages inside the environment's R:</p><pre>Rscript -e "install.packages('Matrix', repos='<a href="https://cloud.r-project.org/">https://cloud.r-project.org/</a>')"</pre><p>These packages will automatically be installed&nbsp;</p><h3>Julia</h3><p>You can install Julia like any other package with</p><pre>micromamba install julia</pre><p>However, the preferred way to install Julia packages is via the Julia package manager. You may, however, find it useful to combine Julia installed inside a conda environment with <a href="https://github.com/JuliaPy/Conda.jl">Conda.jl</a> to install system dependencies for Julia packages.</p>
<h3>How do I use my custom Conda environment with OnDemand Jupyter?</h3><p>See our instructions on <a href="/sites/rc2/SitePages/Jupyter-Open-OnDemand.aspx">this page</a>.</p>
