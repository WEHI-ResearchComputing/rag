<h2><span class="fontColorThemeSecondary">Background</span></h2><p><a href="https://cloud.tower.nf/" data-interception="off" target="_blank" rel="noopener noreferrer"><strong>Nextflow Tower</strong></a> is a graphical web application for running, configuring and monitoring Nextflow pipelines. Some benefits of the Tower include:</p><ul><li>Running Nextflow pipelines without the need for command-line skills</li><li>Monitoring pipelines run by anyone&nbsp;within a lab group</li><li>Sharing of pipelines and pipeline configuration within WEHI</li></ul><p>&nbsp;</p><p>Tower is not a free service, but the <a href="https://biocommons.org.au" data-interception="off" target="_blank" rel="noopener noreferrer"><strong>Australian BioCommons</strong></a>&nbsp;currently provides a free license for WEHI users. WEHI exists as a workspace within the larger BioCommons organisation.</p>
<h2><span class="fontColorThemeSecondary">Privacy and Usage Considerations</span></h2><p>When choosing to use Nextflow Tower, please be aware&nbsp;that Nextflow Tower captures and stores the log files from Nextflow, which may contain:</p><ul><li>Input and output filenames</li><li>Command output (standard out)</li><li>Error messages (standard error)</li><li>Sample identifiers</li><li>Custom logging commands (view operators)</li><li>Pipeline code including process names and configuration</li><li>Pipeline parameter values</li><li>Any reports you have configured with Tower:&nbsp;<a href="https://help.tower.nf/latest/reports/overview/">https://help.tower.nf/latest/reports/overview/</a></li></ul><p>&nbsp;</p><p><strong>Only use Nextflow Tower if&nbsp;it is safe for:</strong></p><ul><li>All members of the&nbsp;workspace (generally, an entire lab)&nbsp;to be able to access these logs</li><li>Research Computing&nbsp;Platform to have access to these logs (RCP administers each workspace)</li><li>BioCommons administrators to have access&nbsp;to these logs (BioCommons runs the Nextflow Tower server)</li><li>Copies of the logs to be stored outside of WEHI, since&nbsp;Tower stores a copy of these logs</li></ul><p aria-hidden="true">&nbsp;</p><p>Also note that Tower does not have a concept of pipeline ownership. <strong>This means that other users with the “Maintain” or “Admin” role within your workspace can deliberately or accidentally edit or delete your pipelines</strong>. Do not use a workspace if you do not trust every user with these roles to have control over your pipeline.</p>
<h2><span class="fontColorThemeSecondary">First Time Setup</span></h2><p>To set up, follow these steps. They only need to be done once.</p><p>&nbsp;</p><h3><span class="fontColorThemeSecondary">Prerequisites</span></h3><p>To start using the NextFlow Tower service, you <strong>must</strong>&nbsp;have access to Milton HPC and a&nbsp;<strong>VAST Scratch space</strong> as Nextflow Tower uses these services to run the pipelines<strong>. </strong>For Milton HPC access and VAST scratch access, please request via <a href="https://support.wehi.edu.au/support/catalog/items/134">the Fresh Service form</a>.</p><p aria-hidden="true">&nbsp;</p><h4><span class="fontColorThemeSecondary"><strong>1 - Login to Tower</strong></span></h4><p><span class="fontColorBlue"><strong>​​​​​​​</strong></span>There is no sign-up process, just go to <a href="https://tower.services.biocommons.org.au/login">https://tower.services.biocommons.org.au/login</a>&nbsp;and enter your WEHI email and follow the instructions.</p><p aria-hidden="true">&nbsp;</p><h4><span class="fontColorThemeSecondary"><strong>2 - Request access to WEHI Workspace</strong></span></h4><p><a href="https://support.wehi.edu.au/support/catalog/items/79"><strong>Fill out and submit this helpdesk form</strong></a>. Please note the following:</p><ul><li>If you choose a workspace other than the&nbsp;WEHI general purpose one, approval from workspace admin or lab head will be required.&nbsp;</li><li>The permission levels as required by the form are defined as:<ul><li><strong>Admin</strong>: You have full permission on the resources associated with the workspace. Therefore you can create/modify/delete Pipelines, Compute environments, Actions, Credentials and Secrets. You can add/remove users to the workspace and edit the workspace settings, but cannot delete it.</li><li><strong>Maintain:&nbsp;</strong>You can launch pipeline and modify pipeline executions (e.g. can change the pipeline launch compute environment, parameters, pre/post-run scripts, Nextflow config), create new pipeline configuration in the Launchpad and Secrets. You cannot modify Compute environment settings and Credentials.</li><li><strong>Launch: </strong>You&nbsp;can launch pipeline executions and modify the pipeline input/output parameters. You cannot modify the launch configuration and other resources.</li><li><strong>View:&nbsp;</strong>You can only access to the team resources in read-only mode.</li></ul></li></ul><p aria-hidden="true">&nbsp;</p><p>RCP will reply to you with the next steps and ultimately provide Tower access.</p><p aria-hidden="true">&nbsp;</p><p><strong>Note:&nbsp;You will not be able to run a pipeline&nbsp;until your access has been granted through the helpdesk.</strong></p><p aria-hidden="true">&nbsp;</p><h4><span class="fontColorThemeSecondary"><strong>3 - Create a NextFlow Tower token</strong></span></h4><p>While waiting for confirmation from RC on your ticket, create a new Tower token by <a href="https://tower.services.biocommons.org.au/tokens">following this link and clicking Add Token</a>. Follow the prompts, then save the token in a permanent, secure location</p>
<h2><span class="fontColorThemeSecondary">WEHI Workspaces</span></h2><p>Currently, the following workspaces are available:</p><ul><li>WEHI_Genomics_Lab: For members of the Advanced Genomics Facility</li><li>WEHI_Bahlo_Lab: For members of the Bahlo Lab</li><li>WEHI_BAC: For members of the Bioimage Analysis Core</li><li>WEHI_Papenfuss_Lab: For members of the Papenfuss Lab</li><li>WEHI: A general-purpose workspace&nbsp;<i>that is visible to anyone in WEHI</i>. Use this if you need to share your Nextflow executions with someone in WEHI, and there is no lab-specific workspace that you all share. Sensitive or private pipelines or data should not be used in this workspace.</li><li><a href="https://tower.services.biocommons.org.au">User Workspace</a>: Each user has their own workspace which is not accessible or visible to any other user. You can use this if you don't need the collaborative features of Tower but still want to run and monitor pipelines via GUI</li></ul><p aria-hidden="true">&nbsp;</p><p>If none of the above workspaces suit you, because you represent a different lab or need to set up a project-specific workspace, you can request a new workspace be created <a href="https://support.wehi.edu.au/support/catalog/items/79">via the same access form</a>.</p>
<h2><span class="fontColorThemeSecondary">Starting the Agent</span></h2><ul><li>The Tower Agent is a small process that must be running on Milton before you can run any pipelines</li><li><strong>GUI (recommended):</strong><ul><li>Open the <a href="https://ondemand.hpc.wehi.edu.au/pun/sys/dashboard/batch_connect/sys/OodTowerAgent/session_contexts/new">OnDemand Tower App</a> and add your access token from step 3 above. Leave the other fields as the default values.</li></ul></li><li><strong>CLI (advanced):</strong><ul><li>Run the following in your terminal​​​​​​​</li></ul></li></ul><pre>ssh vc7-shared\nmodule load nextflow-tw-agent\nexport TOWER_ACCESS_TOKEN=&lt;YOUR TOKEN&gt;\n​​​​​​​mkdir --parents /vast/scratch/users/$USER/nextflow/work\n​​​​​​tw-agent 2fece1e5-3f39-40a9-af0a-349fc8152b5c -u https://tower.services.biocommons.org.au/api --work-dir=/vast/scratch/users/$USER/nextflow/work\n</pre><p style="margin-left:80px;">The agent needs to keep running throughout the lifetime of your pipeline, so it is advisable&nbsp;to run it using tmux or screen</p><p style="margin-left:80px;">'2fece1e5-3f39-40a9-af0a-349fc8152b5c' is WEHI connection id</p>
<h2><span class="fontColorThemeSecondary">Running a Pipeline</span></h2><ul><li>Ensure the Agent is running (see above)</li><li><a href="https://tower.services.biocommons.org.au/orgs/BioCommons/workspaces/WEHI/launchpad" data-interception="off" target="_blank" rel="noopener noreferrer"><strong>Go to the launchpad</strong></a>, and click the pipeline you intend to run.&nbsp;</li><li>Configure the pipeline parameters as appropriate, then click Launch</li></ul>
<h2><span class="fontColorThemeSecondary">Adding a New Pipeline</span></h2><h4><span class="fontColorThemeSecondary"><strong>1 - ​​​​​​​​​​​​​​Open the Form</strong></span></h4><p><span class="fontColorThemeSecondary">​​​​​​​</span>Go to the Launchpad in the WEHI workspace and click&nbsp;<a href="https://tower.services.biocommons.org.au/orgs/BioCommons/workspaces/WEHI/launchpad/new" data-interception="off" target="_blank" rel="noopener noreferrer">Add pipeline</a></p><p aria-hidden="true">&nbsp;</p><h4><span class="fontColorThemeSecondary"><strong>2 - Fill in the Form</strong></span></h4><p>Fill in the form as appropriate, with the following requirements</p><ul><li>The compute environment must be set to WEHI_Milton (the default)</li><li>The work directory must be set to&nbsp;$TW_AGENT_WORK&nbsp;(the default)</li><li>If the pipeline <strong>is an NF Core</strong> pipeline, the list of config profiles must include "wehi"</li><li><div class="imagePlugin" style="background-color:transparent;position:relative;" data-alignment="Left" data-imageurl="https://wehieduau.sharepoint.com/sites/rc2/SiteAssets/SitePages/Nextflow-Tower/1547082776-image.png" data-isdecorative="false" data-imagenaturalheight="155" data-imagenaturalwidth="383" data-siteid="93ee3842-f21b-4d8d-b85b-874e64c67802" data-webid="95711e2c-a16f-49a8-9adc-1b9756d4ee5e" data-listid="3d75202a-c480-42f5-abb7-5e7b39fc27d5" data-uniqueid="9ddc3552-5b45-41ab-a8f0-2231363757e8" data-height="118.23192239858909" data-width="292.147266313933" data-widthpercentage="33.774250440917115"></div></li><li>If the pipeline&nbsp;<strong>is not&nbsp;</strong>an NF Core pipeline, under Advanced options, edit the Nextflow config file. You must add add the following at minimum:&nbsp;</li></ul><pre>includeConfig '<a href="https://raw.githubusercontent.com/nf-core/configs/master/conf/wehi.config">https://raw.githubusercontent.com/nf-core/configs/master/conf/wehi.config</a>'</pre><ul><li>Ensure that the Pre-run script includes, at very least, module load nextflow&nbsp;(the default)</li></ul>
<h4><span class="fontColorThemeSecondary"><strong>3 - Click Add​​​​​​​</strong></span></h4><div class="imagePlugin floatLeft" style="background-color:transparent;position:relative;" data-alignment="FloatLeft" data-imageurl="https://wehieduau.sharepoint.com/sites/rc2/SiteAssets/SitePages/Nextflow-Tower/720087000-image.png" data-isdecorative="false" data-imagenaturalheight="45" data-imagenaturalwidth="201" data-siteid="93ee3842-f21b-4d8d-b85b-874e64c67802" data-webid="95711e2c-a16f-49a8-9adc-1b9756d4ee5e" data-listid="3d75202a-c480-42f5-abb7-5e7b39fc27d5" data-uniqueid="53af1e8f-3e66-4a6a-98a9-fca3ec720fb7" data-height="34.776182432432435" data-width="155.33361486486487" data-widthpercentage="16.97635135135135"></div><h4>&nbsp;</h4>
