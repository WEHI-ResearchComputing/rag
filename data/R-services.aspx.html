<h2><span class="fontColorThemeSecondary">R services at WEHI</span></h2><p>This document provides an overview of R services offered at WEHI and recommended practices for using R and maintaining your R software library.</p><p>The main ways&nbsp;we deliver R are listed below:</p>
<h4><span class="fontColorBlue">Contents on this page:</span></h4><ul><li><a href="#ondemand-rstudio">RStudio&nbsp;</a><a href="/sites/rc2/SitePages/R-services.aspx#ondemand">OnDemand</a></li><li><a href="/sites/rc2/SitePages/R-services.aspx#posit-workbench-aka-rstudio-pro">Posit Workbench</a></li><li><a href="/sites/rc2/SitePages/R-services.aspx#r-services-at-wehi">R services at WEHI</a></li><li><a href="/sites/rc2/SitePages/R-services.aspx#session-policy">Session policy</a></li><li><a href="/sites/rc2/SitePages/R-services.aspx#command-line-and-batch">Command-line and batch</a></li><li><a href="/sites/rc2/SitePages/R-services.aspx#maintaining-your-r-library">Maintaining your R library</a></li><li><a href="/sites/rc2/SitePages/R-services.aspx#modules-in-r">Modules in R</a></li></ul>
<h3><span class="fontColorThemeSecondary">OnDemand RStudio</span></h3><blockquote><p><span class="fontColorRed">Note:</span> <span class="fontColorThemeSecondary">RC recommends that researchers&nbsp;use the Open OnDemand RStudio option.</span></p></blockquote><p>WEHI runs an <a href="/sites/rc2/SitePages/Open-OnDemand.aspx"><strong>Open OnDemand</strong></a> server available through <a href="https://ondemand.hpc.wehi.edu.au/">ondemand.hpc.wehi.edu.au</a>. OnDemand provides a number of options for running GUI applications in the batch system, including RStudio.</p><p>The advantages of using RStudio OnDemand are:</p><ul><li>Sessions run on SLURM, so better resource management is achieved;</li><li>Sessions use VAST scratch automatically if users have a space, this makes loading and saving sessions faster.</li><li>More resources (RAMs and CPU Cores) are available to be allocated;&nbsp;</li><li>Other R users will not affect your sessions; thus it is less probable that your session will crash because of another user.</li></ul><p>On the other hand:</p><ul><li>While effort is made by the Research Computing teams to keep wait times for moderate resources as short as possible, instant access to resources cannot be guaranteed. A large resource request may incur a significant wait.</li><li>You need to have an idea of what resources you need when you start your session, including the length of your session.</li><li>Sessions are lost when the underlying SLURM job finishes.</li></ul><p><strong>For more information about using RStudio OnDemand, </strong><a href="/sites/rc2/SitePages/RStudio-OnDemand.aspx"><strong>please refer to the dedicated help page here.</strong></a></p><h3><span class="fontColorThemeSecondary">Posit Workbench aka RStudio Pro</span></h3><p>WEHI has two <a href="/sites/rc2/SitePages/RStudio.aspx"><strong>Posit Workbench servers</strong></a> available at&nbsp;<a href="http://rstudio.hpc.wehi.edu.au">rstudio.hpc.wehi.edu.au</a>. Posit Workbench was previously known as RStudio Server Pro, and it is still occasionally referred to as such.</p><p>Posit Workbench has the following advantages:</p><ul><li>Quick and easy to access via the web portal</li><li>There is no session time limit</li></ul><p>On the other hand, our Posit Workbench servers are often heavily used <strong>leading to crashes&nbsp;and poor performance</strong>.</p><p><strong>For more information about Posit Workbench at WEHI, please refer to the </strong><a href="/sites/rc2/SitePages/RStudio.aspx?Mode=Edit"><strong>dedicated help page</strong></a><strong>.</strong></p><h3><span class="fontColorThemeSecondary">Command-line and batch</span></h3><p>R is also available through the <a href="/sites/rc2/SitePages/modules.aspx"><strong>module system</strong></a> for use at the command line or in SLURM scripts. In particular your can load an R module to make the corresponding version of R available to you on the command line. For example, this command will load R version 4.3.0:</p><pre> module load R/4.3.0</pre><p>&nbsp;Examples of R SLURM jobs are found <a href="/sites/rc2/SitePages/SLURM-advanced-job-scripts.aspx#rscript"><strong>here</strong></a><strong>&nbsp;</strong>and&nbsp;installing R packages is described <a href="/sites/rc2/SitePages/Installing-software.aspx#installing-r-packages"><strong>here</strong></a>.</p><h3><span class="fontColorThemeSecondary">Maintaining your R library</span></h3><p>All of these&nbsp;methods of accessing&nbsp;R all share the same user libraries. The location of these libraries is returned&nbsp;by the <span class="fontColorBlue">.libPaths()</span> function. When R searches for packages, for example when a library is being loaded, it looks at each location sequentially:</p><pre>&gt; .libPaths()\n[1] "/stornext/Home/data/allstaff/m/milton.m/R/x86_64-pc-linux-gnu-library/4.2"\n[2] "/stornext/System/data/apps/R/R-4.2.1/lib64/R/library</pre><p>The first location is in your home directory, which is where all packages you install will be placed. The final component of the path (4.2 in this case) will vary depending on the minor version of R that you are using, so you will need to re-install all your packages if you start using a newer version of R. However, patch versions like 4.2.3 and 4.2.0&nbsp;share the same library.</p><p>You may find that R packages use a significant amount of your home quota if you install a lot of them. To resolve this, you can try one of two solutions:</p><ul><li>Move your R library to another filesystem, as explained below</li><li>Strip the debug symbols from your R libraries, <a href="/sites/RCPNewsletter/SitePages/March-2023-Issue.aspx#roadblocks">as explained here</a></li></ul><p><strong>Note that, although you can&nbsp;move your R library to VAST Scratch, which has effectively unlimited space, it&nbsp;means that you will have to reinstall your R packages every 2 weeks, which may not be favourable.</strong></p><p>To move your R library, just put the following into&nbsp;~/.Renviron:</p><pre>​​​​​​​R_LIBS_USER=/path/to/filesystem/R/%p/%v ​​​\n\n</pre><p>Once you do so, you will have to re-install all the packages into the new library.</p><h3><span class="fontColorThemeSecondary">Module Differences</span></h3><p>One issue you might encounter when using Milton's R modules is that different R versions have different default packages installed. For example, the curl, magick, magrittr and Rcpp packages are installed by default in the R 4.2.3 module but not R 4.3.0. This may mean that, if you try to port your code from 4.2.3 to 4.3.0, you may get an error message such as “there is not package called Rcpp”. You can easily resolve this issue by manually installing the problematic package with install.packages().</p><p>For this reason, it is not recommended to rely on the pre-installed packages other than R's standard packages: base, compiler, datasets, grDevices, graphics, grid, methods, parallel, splines, stats, stats4, tcltk, tools, translations, and utils. You should include all other packages in your package management strategy. This strategy should ideally involve renv, but might instead be a list of packages you record for your analysis, or might be a list of install.packages() commands you embed in your script or notebook.</p>
<h3><span class="fontColorThemeSecondary">Modules in R</span></h3><p>R software frequently depends on other system libraries. ITS make these libraries available through the module system. More on the subject <a href="/sites/rc2/SitePages/modules.aspx">here</a>.</p><p>Modules need to be preloaded before starting R. <strong>Running </strong><i><strong>module load </strong></i><strong>in an RStudio terminal tab</strong> <strong>will not make the module accessible to R.</strong> Preloading modules is managed in different ways for each of the different R environments:<br>&nbsp;</p><ul><li><strong>RStudio OnDemand</strong> provides an option to specify which modules to preload when you launch a session (see image). Note that you need to put a space between each module you want.</li></ul><div class="imagePlugin" style="background-color:transparent;position:relative;" data-alignment="Left" data-imagenaturalheight="521" data-imagenaturalwidth="935" data-imageurl="https://wehieduau.sharepoint.com/sites/rc2/SiteAssets/SitePages/R-services/2802257395-image.png" data-isdecorative="false" data-listid="3d75202a-c480-42f5-abb7-5e7b39fc27d5" data-siteid="93ee3842-f21b-4d8d-b85b-874e64c67802" data-uniqueid="d8db7310-ab81-4738-9253-3a986df92eea" data-webid="95711e2c-a16f-49a8-9adc-1b9756d4ee5e" data-height="260.12559188893687" data-width="467.4287455782045" data-widthpercentage="39.477737228489914"></div><ul><li><strong>Posit Workbench</strong><ul><li>Workbench preloads the following modules:<ul><li>JAGS</li><li>openCV</li><li>gdal</li><li>geos</li><li>proj</li><li>gcc/11.1.0 (gcc/9.1.0 for R &lt; 4.2.0)</li><li>hdf5/1.8.20</li></ul></li><li>You can load additional modules by adding <i>module load</i> commands to&nbsp;~/.r_bashrc, which is a Posit Workbench specific startup script for Bash</li></ul></li><li>For <strong>batch and CLI</strong>, load modules with the <i><span class="fontColorBlue">module load</span></i> command before starting R</li></ul><p>To optimise your workflow, you may be interested in the <a href="https://wehi-researchcomputing.github.io/EnvironmentModules/">EnvironmentModules</a>&nbsp;R package, which provides a way to load modules from within R and use them to install packages, without having to restart R. Using this method, you also won't have to remember to load the dependency modules each time you use a package that requires them, since the modules will be "baked in".</p>
<h3><span class="fontColorThemeSecondary">Related Research Computing Pages</span></h3><ul><li><a href="/sites/rc2/Learning%20R/Forms/AllItems.aspx">R Training Resources</a>​​​​​​​</li><li><a href="/sites/rc2/SitePages/Installing-software.aspx#installing-r-packages">Installing R Packages</a></li><li><a href="/sites/rc2/SitePages/SLURM-advanced-job-scripts.aspx#rscript">Submitting R Slurm Scripts</a></li></ul>
<h3><span class="fontColorThemeSecondary">Useful Resources</span></h3>
