<h2>Protein folding at WEHI using&nbsp;AlphaFold</h2><p>On the 15th of July Nature published&nbsp;<a href="https://www.nature.com/articles/s41586-021-03819-2" data-interception="off" target="_blank" rel="noopener noreferrer">Highly accurate protein structure prediction with AlphaFold</a><strong>.&nbsp;</strong>AlphaFold, developed by&nbsp;<a href="https://deepmind.com/" data-interception="off" target="_blank" rel="noopener noreferrer">DeepMind</a>, proposes a solution for a 50 year old "Protein Folding Problem".</p><p>The research computing teams, ITS Research Systems, and RCP,&nbsp;were&nbsp;faced with two challenges&nbsp;to make it work on Milton:&nbsp;</p><ul><li><strong>Firstly,</strong>&nbsp;Alphafold was tested on&nbsp;Google Cloud with a machine using the&nbsp;nvidia-gpu-cloud-image&nbsp;with 12 vCPUs, 85 GB of RAM, a 100 GB boot disk, the databases on an additional 3 TB disk, and an&nbsp;<a href="https://www.nvidia.com/en-au/data-center/a100/"><strong>A100</strong></a>&nbsp;GPU (40 GPU Memory). Milton has 20 older technology&nbsp;<a href="https://www.nvidia.com/en-au/data-center/tesla-p100/"><strong>P100</strong></a>&nbsp;(each with 12GB GPU Memory) nodes.&nbsp;</li><li><strong>Secondly</strong>, and more challengingly, the&nbsp;<a href="https://github.com/deepmind/alphafold"><strong>source code</strong></a>&nbsp;provided from DeepMind was not designed to run in an HPC environment. They provided a docker image to run Alphafold, which is not supported&nbsp;in most HPC environments.</li></ul><p>To test it on our GPU nodes, we first tried installing Alphafold without docker&nbsp;in a conda environment. And&nbsp;as anyone&nbsp;who used conda + python +&nbsp;cuda together can relate, it took a few tries to get the whole dependency tree&nbsp;correctly installed and running. It takes time to set up the environment and it is more difficult to use. It is better suited to a development environment where finer grained control is needed. Nevertheless, for those interested, we have all of the steps documented&nbsp;in&nbsp;<a href="https://github.com/WEHI-ResearchComputing/alphafold" data-interception="off" target="_blank" rel="noopener noreferrer">our github repository</a><strong>.&nbsp;</strong></p><p>And, YES we were able to run Alphafold on P100, but we have a limited GPU memory (12GB) which limits the length of the input sequence. We are investigating multi-GPU options to support larger sequences.</p><p>To overcome the second challenge, we built&nbsp;a Singularity container. Singularity is another container technology similar to Docker but designed to work in multiuser HPC environments. We also needed to rewrite the&nbsp;wrapper scripts to work with Singularity. Finally, we made it available via the modules system.</p><p>Alphafold relies on 2.7TB of sequence databases. These have been downloaded and made available on our VAST high performance storage.</p>
<p>This website has a documentation page on&nbsp;<a href="/sites/rc2/SitePages/AlphaFold.aspx">how to run Alphafold on Milton</a><strong>&nbsp;</strong>with sample slurm scripts found in&nbsp;</p><pre>/stornext/System/data/apps/sample-scripts/alphafold/</pre><h3>​​​​​​​​​​​​​​<br><span class="fontColorThemeSecondary">Where are we now?</span></h3><p>At the moment, there is two versions of Alphafold on our modules system.</p><ol><li><strong>alphafold/2.0.0</strong><br>This version will run all parts of the Alphafold pipeline in one job/task.<br><br>&nbsp;</li><li><strong>alphafold/2.0.1</strong><br>This version will run give you the option to run the alignment and search&nbsp;part&nbsp;(uses only cpus) independent of the model inference part (uses gpus) of the Alphafold pipeline. This is more efficient in terms resource allocation.</li></ol><p>Details on how to use both versions are in the&nbsp;<a href="https://rc.wehi.edu.au/Documentation/advanced-tools/alphafold"> Alphafold page</a>&nbsp;on this website.</p>
<h3><span class="fontColorThemeSecondary">What next?</span></h3><p>We are now working on two updates to add to the current module system.</p><ol><li>adding a&nbsp;homooligomer option with/wihout templates based on&nbsp;<a href="https://colab.research.google.com/github/sokrypton/ColabFold/blob/main/AlphaFold2.ipynb#scrollTo=kOblAo-xetgx">this Alphafold Colab notebook</a></li><li>adding an option to enable/disable the final amber relaxation step, and/or run it in an independent step.<br><br>&nbsp;</li></ol><p>It was an exciting adventure and we look forward to your comments and feedback.</p>
<p style="text-align:center;"><span class="fontColorYellowLight">Written by:</span> Julie Iskander &amp; Miguel Esteva (27 August 2021)<br><span class="fontColorYellowLight">First printed:</span> RCP News - <a href="/sites/RCPNewsletter/SitePages/August-2021-Issue.aspx?from=SendByEmail&amp;e=cGj8uzTJmE-DOnUP5wuNMw&amp;at=9&amp;CT=1631253302016&amp;OR=OWA-NT&amp;CID=888d4b89-b449-f8fe-5d62-40c7c003bac7">August 2021 issue</a></p>
